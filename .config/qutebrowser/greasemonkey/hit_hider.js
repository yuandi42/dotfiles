// ==UserScript==
// @name        Google Hit Hider by Domain (Search Filter / Block Sites)
// @author      Jefferson "jscher2000" Scher
// @namespace   JeffersonScher
// @version     2.2.1
// @copyright   Copyright 2021 Jefferson Scher
// @license     BSD-3-Clause
// @description Block unwanted sites from your Google, DuckDuckGo, Startpage.com, Bing and Yahoo search results. v2.2.1 2021-08-29
// @include     http*://www.google.*/*
// @exclude http*://www.google.com/recaptcha/*
// @include     http*://www.google.co*.*/*
// @include     http*://news.google.*/*
// @include     http*://encrypted.google.*/*
// @include     http*://startpage.com/*
// @include     http*://*.startpage.com/*
// @exclude https://www.startpage.com/*/ads?*
// @include     http*://duckduckgo.com/*
// @include     http*://start.duckduckgo.com/*
// @include     http*://safe.duckduckgo.com/*
// @include     http*://3g2upl4pq6kufc4m.onion/*
// @include     http*://www.bing.com/*
// @include     http*://*search.yahoo.com/*
// @include     http*://search.yahoo.co.jp/*
// @include     http*://www.yandex.com/*
// @include     http*://yandex.com/*
// @include     http*://searx.*/*
// @include     http*://www.qwant.com/*
// @include     http*://www.qwantjunior.com/*
// @include     http*://www.baidu.com/*
// @include     https://www.ecosia.org/search*
// @grant       GM_getValue
// @grant       GM.getValue
// @grant       GM_setValue
// @grant       GM.setValue
// @grant       GM_registerMenuCommand
// @grant       GM_deleteValue
// @grant       GM.deleteValue
// @grant       GM_getResourceURL
// @grant       GM.getResourceUrl
// @resource    mycon http://www.jeffersonscher.com/gm/src/oujs-GHHbD-v221.png
// @updateURL   https://openuserjs.org/meta/jscher2000/Google_Hit_Hider_by_Domain_(Search_Filter_Block_Sites).meta.js
// ==/UserScript==
var script_about="https://openuserjs.org/scripts/jscher2000/Google_Hit_Hider_by_Domain_%28Search_Filter_Block_Sites%29",GM4=void 0!==GM.getValue;
/*
Copyright (c) 2021 Jefferson Scher. All rights reserved.

Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met and subject to the following restriction:

1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.

2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function GHHbD_addStyle(txt){var s=document.createElement('style');s.className='GHHbDcss',s.appendChild(document.createTextNode(txt)),document.body.appendChild(s)}var isch=!1;function injectBaseCSS(){
// Standard image results style block
if(
// == == == To override the style of the script's buttons and panes, use the custom style feature == == ==
GHHbD_addStyle("div.ghhider{color:#888;} div.ghhider:hover{background-color:#eee;} button.ghhider{color:#555;background-color:#fcfcfc;font-family:sans-serif;font-size:0.85em;line-height:1.2em;margin:auto 2px;border:1px solid #ccc;border-radius:4px;padding:2px 3px;} h3>button.ghhider{font-size:0.75em;} button.ghhider:hover{color:#000;background:#ff8;} .ghh1time{background:#eee !important;} .ghhdnone{display:none !important;} .ghhpane{position:absolute;color:#333;background-color:#fcfcfc;border:1px solid #ccc;border-radius:4px;padding:0.25em 1.5em;font-size:13px;display:none} #ghhsitelist, #ghhpbanlist{background:#fff;list-style-type:none;padding:0;margin:0;} #ghhsitelist li,#ghhpbanlist li{width:100%;line-height:1.5em;padding:0;position:relative} #ghhsitelist li:nth-of-type(odd),#ghhpbanlist li:nth-of-type(odd){background-color:#fcfcaa} .ghhhost{display:block;padding:0 0.25em;cursor:pointer;} #ghhutil{text-align:center;margin:0.5em 0 1em 0;border:1px solid #ccc;border-radius:4px;padding:3px 0;} .ghhinfo{font-size:12px;line-height:9px;position:absolute;top:0;right:0;z-index:1001;border:4px solid transparent;border-radius:4px;border-bottom-left-radius:8px;border-top-left-radius:8px;margin-top:1px;padding-left:1px} .ghhdel{text-decoration:line-through;color:#333;} .ghhpb{text-decoration:none;color:#f00;} .ghhblk{text-decoration:none;color:#333;} .ghhd{position:relative;line-height:1.2em;cursor:pointer;} .ghhindent{position:absolute;left:350px;top:-3px;} #btnedit p{margin:2px 4px 4px 4px;} #ghhblockform input[type='radio'], #ghhmngform input[type='radio']{vertical-align:baseline !important;margin-top:5px;margin-bottom:1px} #ghhblockform label, #ghhmngform label{display:inline;font-weight:normal;font-size:unset;} .ghhtbl{border:1px solid black;border-collapse:collapse} .ghhtbl td, .ghhtbl th{border:1px solid black;padding:2px 4px;} #ghhtsdiv{margin:0 -1.5em;padding:0 3px 0 8px;border-bottom:1px solid #ccc;} #ghhtstrip{padding-bottom:0;} #ghhtstrip button{color:#555;background-color:#f5f5f5;margin:0 2px 0 0;border:1px solid #ccc;padding:1px 2px;height:22px;border-radius:2px;} #ghhtstrip .ghhCurTab{background-color:#fcfcfc;border-bottom-color:#fcfcfc;} .ghhtab {margin-top:1em;height:17em;overflow-y:scroll;border:1px solid #333;} #mflists>div>p{margin:1em 0;} #ghhmngform{position:fixed;top:65px;right:0;z-index:9001;text-align:left;line-height:1.2em} #ghhblockform{text-align:left;z-index:3005} h3[wotdonut=\"true\"]{overflow:visible!important}"),GHHbD_addStyle("@media print {button.ghhider{display:none;}}"),location.search.indexOf("tbm=isch")>-1){var ghhbd_imgsty=document.createElement("style");ghhbd_imgsty.id="ghhStyleImgResults",ghhbd_imgsty.setAttribute("type","text/css"),ghhbd_imgsty.appendChild(document.createTextNode('div[imgblock="regular"] img{opacity:0.1 !important} div.isv-r[imgblock="regular"] a div:first-of-type{opacity:0.6 !important} div[imgblock="regular"]:not(.isv-r) a div{display:block !important;opacity:0.6 !important}div[imgblock="regular"] img:hover{opacity:0.5 !important} div[imgblock="pban"]{background-color:#aaa !important;border-radius:6px !important} div[imgblock="pban"] a{display:none !important}')),document.body.appendChild(ghhbd_imgsty),isch=!0}}injectBaseCSS();var custSty,currentG=location.hostname,engine='misc';function doSiteSpecific(){currentG.indexOf("google")>-1&&(engine='Google'),currentG.indexOf("bing.com")>-1&&(engine='Bing',
// Bing: div#b_content > main > ol#b-results > li.b_algo > h2 > a
GHHbD_addStyle("li[ghhresult] h2 button.ghhider{font-size:0.7em !important;} li > h2 {white-space:nowrap !important;}")),(currentG.indexOf("duckduckgo")>-1||currentG.indexOf("3g2upl4pq6kufc4m")>-1)&&(engine='DDG',
// DuckDuckGo: div#links > div.results_links_deep > div.links_main > h2 > a
GHHbD_addStyle(".links_main,.result__title{overflow:visible !important;} .result__title{white-space:nowrap !important;} .ghhb{font-size:12px!important;margin-left:4px!important;} .results_links_deep[blocknotice] + .results__sitelink--organics, .ghhdnone + .results__sitelink--organics, .results_links_deep[blocknotice] + .result__sitelinks--organics, .ghhdnone + .result__sitelinks--organics {display:none;}")),currentG.indexOf("startpage")>-1&&(engine='Startpage',
// Startpage: div#results > ol > li > div.result > h3 > a
// 11/21/2018: [data-view="results"] div.columns article.column.column--main > div.column.column--main__content > ol.list-flat > li.search-result.search-item > h3.search-item__title > a
//  7/03/2019: div.mainline-results__web section.w-gl > div.w-gl__result > a.w-gl__result-title
GHHbD_addStyle(".w-gl__result{overflow:visible !important;} .ghhd{padding:0 10px 8px 12px}button.ghhider{font-weight:normal}#ghhblockform input[type=\"checkbox\"], #ghhmngform input[type=\"checkbox\"]{width:unset;height:unset;position:static;margin:unset;border:unset;padding:unset;clip:unset;}#ghhblockform button, #ghhmngform button{font-size:1em;font-weight:normal;border:1px solid #e3e3e3;border-radius:3px;padding:2px 8px;box-shadow:none} #ghhmngform{top:105px !important;}")),currentG.indexOf("yahoo.com")>-1&&(engine='Yahoo',
// Yahoo (Firefox): div#results > div#cols > div#left > div > div#main > div > div#web > ol > li > div > div > h3 > a
// GHHbD_addStyle("div#web > ol.reg, li div.compTitle {overflow:visible !important;} .ghhd{margin: 1em 0px -1em 10px} #ghhmngform{top:80px} li div div h3{white-space:nowrap !important;}");
GHHbD_addStyle("div#web > ol.reg, li div.compTitle {overflow:visible !important; border-top:0.1px solid transparent;} .ghhd{margin: 1em 0px 0px 0px} #ghhmngform{top:80px} li div div h3{white-space:normal !important;}")),currentG.indexOf("yahoo.co.jp")>-1&&
// Yahoo Japan (OLD): div#contents > div > div > div > div#WS2m > div.w > div.hd > h3 > a
// Yahoo Japan: div#contents > div#contents__wrap > div.Contents__inner Contents__inner--main > div.Contents__innerGroupBody > div.sw-CardBase div.sw-Card__title > a > h3 //v2.2.1
GHHbD_addStyle("#WS2m .w{overflow:visible !important;} #ghhmngform{z-index:3001}"),currentG.indexOf("baidu")>-1&&(engine='Baidu'),currentG.indexOf("yandex.com")>-1&&
// Yandex: div.serp-list | ul.serp-list > div.serp-item | li.serp-item > h2 > a
GHHbD_addStyle("h2.serp-item__title{white-space:nowrap;}.ghhb{font-size:0.75em!important;margin-left:4px!important;}"),currentG.indexOf("qwant")>-1&&
// Qwant: div.results-column > div.result_fragment > div.result--web | div.result--news > h3 > a
GHHbD_addStyle("div[blocknotice]:not(.ghh1time){min-height:1em;padding-left:0;}"),currentG.indexOf("searx")>-1&&
// Searx.me: div#main_results > div.result > h4.result_header > a
GHHbD_addStyle("h2.serp-item__title{white-space:nowrap;}.ghhb{font-size:0.75em!important;margin-left:4px!important;}"),currentG.indexOf("ecosia")>-1&&(engine='Ecosia',
// Ecosia: div.results-wrapper > div.container.results ... div.card-web ... div.result-firstline-title > a.result-title
GHHbD_addStyle("[ghhresult] h2.result-firstline-title>a.result-title{display:inline;}.ghhider{font-size:0.6em!important;}"))}function injectCustom(){if(!document.getElementById("ghhbdcuststy")){var ghhbd_custsty=document.createElement("style");ghhbd_custsty.setAttribute("type","text/css"),ghhbd_custsty.id="ghhbdcuststy",ghhbd_custsty.appendChild(document.createTextNode(custSty)),document.body.appendChild(ghhbd_custsty)}}doSiteSpecific(),GM4?GM.getValue("hiderStyles","").then((function(value){(custSty=value).length>0&&injectCustom()})):(custSty=GM_getValue("hiderStyles","")).length>0&&injectCustom();
// == == == Globals for preferences == == ==
var blist,defaultTxts,txtsPref,txts,defaultPrefs,ghhPrefs,ghhPrefO,showYN,mpopen,mbstyle,bbstyle,bbpos,addAt,listchgs,bLUopen,bAggress,bAJAX,bMutOb,pref1click,betatest,MutOb,chgMon,opts,kids,t_pb,needupdate=!0,doms=[],patIPv4=/\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/;function checkblist(){0===blist.length&&(blist="|example.com:t|"),"|"!=blist.substr(0,1)&&(blist="|"+blist),blist.indexOf(":")<0&&convertFormat()}function checktxts(){-1==txtsPref.indexOf(":[")||-1==txtsPref.indexOf("mngbtn")||-1==txtsPref.indexOf("eximbtn")||-1==txtsPref.indexOf("utilbtn")||-1==txtsPref.indexOf("impobtn")||-1==txtsPref.indexOf("addallbtn")?convertTxts(txtsPref):txts=JSON.parse(txtsPref)}function checkprefs(){0==ghhPrefs.length?convertPrefs(defaultPrefs,"true"):ghhPrefs.indexOf("reserved1")>-1?convertPrefs(defaultPrefs,"false"):ghhPrefO=JSON.parse(ghhPrefs)}function GHHbDinit(){if(showYN=ghhPrefO.shownotc[0],mpopen=ghhPrefO.mngpaneopen[0],"mng"==(mbstyle=ghhPrefO.mngbtnstyle[0]).split("-")[0]&&toggleBlockHiders("H"),mbstyle.split("-").length<3)GHHbD_addStyle("#ghhMngBtn {position:fixed;top:150px;right:-2.8em;-moz-transform:rotate(-90deg);-webkit-transform:rotate(-90deg);border-bottom:0;border-bottom-left-radius:0;border-bottom-right-radius:0;padding:6px 1px;z-index:1000;}");else switch(mbstyle.split("-")[2]){case"B":GHHbD_addStyle("#ghhMngBtn {position:fixed;bottom:0;right:2px;border-bottom:0;border-bottom-left-radius:0;border-bottom-right-radius:0;padding:6px 1px;z-index:1000;}");break;case"T":GHHbD_addStyle("#ghhMngBtn {margin:0;padding:4px 6px;z-index:3000;}"),document.querySelector("#appbar ol")?(window.setTimeout((function(){document.querySelector("#appbar ol#ab_ctls").appendChild(document.getElementById("ghhMngBtn"))}),1e3),window.setTimeout((function(){var liNew=document.createElement("li");liNew.className="ab_ctl",liNew.appendChild(document.getElementById("ghhMngBtn")),document.querySelector("ol#ab_ctls").appendChild(liNew)}),1500)):window.setTimeout((function(){if(document.querySelector("#appbar ol")){var liNew=document.createElement("li");liNew.className="ab_ctl",liNew.appendChild(document.getElementById("ghhMngBtn")),document.querySelector("ol#ab_ctls").appendChild(liNew)}else document.getElementById("ghhMngBtn").setAttribute("style","position:absolute;top:8em;right:0")}),1500);break;default:GHHbD_addStyle("#ghhMngBtn {position:fixed;top:150px;right:-2.8em;-moz-transform:rotate(-90deg);-webkit-transform:rotate(-90deg);border-bottom:0;border-bottom-left-radius:0;border-bottom-right-radius:0;padding:6px 1px;z-index:1000;}")}if(bbstyle=mbstyle.split("-").length>3?mbstyle.split("-")[3]:"P",bbpos=mbstyle.split("-").length>5?mbstyle.split("-")[5]:"H",
// toggleciteline(bbpos); called by fixuistyle()
addAt=ghhPrefO.addtolistpos[0],listchgs=0,bLUopen="N",bAggress=ghhPrefO.aggressiveblock[0],bAJAX=ghhPrefO.usemutation[0].split("-")[0],bMutOb=ghhPrefO.usemutation[0].split("-").length>1?ghhPrefO.usemutation[0].split("-")[1]:"Y",pref1click=ghhPrefO.oneclick[0],betatest=ghhPrefO.runbeta[0],document.body){
// Special results layout
if(
// Add buttons, hide unwanted domains
hidehits(null,!1),document.getElementById("GTR")&&removePBs(),"Y"==betatest){var itbl=document.querySelector("#res .images_table");itbl&&hidebasic(itbl)}
// Create skeleton of manage form
document.getElementById("ghhmngform")||addManageForm(),
// Add manage button
document.getElementById("ghhMngBtn")||"blk"==mbstyle.split("-")[0]||('Google'==engine?(document.getElementById("res")||isch)&&addMngBtn():addMngBtn()),
// Show pane if last open
"Y-Y"==mpopen.substr(0,3)&&showManageForm("mngform"),
// Add menu item - Legacy Only
"undefined"!=typeof GM_registerMenuCommand&&GM_registerMenuCommand("Manage Hiding",showManageForm),
// Create block form
document.getElementById("ghhblockform")||addBlockForm(),
// Watch for changes that could be new instant or AJAX search results
"on"==bAJAX&&setMutationWatch()}}function setMutationWatch(){
// Prefer MutationObserver (Firefox 14+) over Mutation Events
(MutOb=window.MutationObserver?window.MutationObserver:window.WebKitMutationObserver)&&"Y"==bMutOb?(chgMon=new MutOb((function(mutationSet){mutationSet.forEach((function(mutation){if("childList"==mutation.type)for(var i=0;i<mutation.addedNodes.length;i++)1==mutation.addedNodes[i].nodeType&&checkNode(mutation.addedNodes[i]);else// attribute mutation on Google Images
"rg_l"==mutation.target.className&&checkNode(mutation.target.parentNode)}))})),
// attach chgMon to document.body
opts=1==isch?{childList:!0,subtree:!0,attributes:!0,attributeFilter:["href"],characterData:!1}:{childList:!0,subtree:!0,attributes:!1,characterData:!1},chgMon.observe(document.body,opts)):"Y"==bMutOb&&// Legacy browser support and Baidu
document.body.addEventListener("DOMSubtreeModified",checkOlist,!1)}
// == == == Main Event Loops == == ==
GM4?GM.getValue("hideyhosts","").then((function(value){blist=value,checkblist()})):(blist=GM_getValue("hideyhosts",""),checkblist()),defaultTxts={block:["block","Button next to the result title to call up the block dialog"],unblock:["Unblock","Green button in results to remove a site from the block list"],onetime:["Show Hit","Yellow button in results to show a result temporarily"],pban:["Perma-ban","Red button to move a site to the perma-ban list"],shownotc:["Show Notices","Button to set the preference for notices to show them"],hidenotc:["Hide Notices","Button to set the preference for notices to hide them"],okbtn:["Block Site","Button in the block dialog to block the selected domain"],cancelbtn:["Cancel","Button in the block dialog to cancel out with making changes"],savebtn:["Save Lists","Button in the management pane to update the block and perma-ban lists"],closebtn:["Close","Button in the management pane to close the pane"],okPbtn:["Perma-ban","Button in the block dialog to perma-ban the selected domain"],cancelMbtn:["Manage Hiding","Button in the block dialog to open the management pane"],mngbtn:["Manage Hiding","Button on the right side to open the management pane"],eximbtn:["Export","Button in the management pane to export the block list"],utilbtn:["List Util","Button in the management pane to open the utility panel"],sortbtn:["Sort","Button in the management pane to sort the block list"],unwwwbtn:["Un-www","Button in the management pane to strip www from blocked domains"],dedupbtn:["De-Dup","Button in the management pane to de-duplicate the block list"],impobtn:["Import","Button in the management pane to import domains into the block list"],sharebtn:["Share","Button in the management pane to post block list to the web"],addallbtn:["Add All","Button in the management pane to bulk add all unblocked domains to current list"]},GM4?GM.getValue("textstrings",JSON.stringify(defaultTxts)).then((function(value){txtsPref=value,checktxts()})):(txtsPref=GM_getValue("textstrings",JSON.stringify(defaultTxts)),checktxts()),defaultPrefs={shownotc:["Y","Show hit notices(Y|N)"],mngpaneopen:["Y-N","Persistence enabled(Y|N),Pane was open(Y|N),Last tab number(1-4)"],mngbtnstyle:["both-ifrN-R-P-Y-H","Display Manage Hiding button and Block buttons(mng|blk|both),In iframes(ifrN|ifrY),Position(R,T,B),Block button display(P,M),Block button tooltips(Y|N), Block button position(H|C)"],addtolistpos:["end","Where to add new hits to block lists(end|top|sort)"],aggressiveblock:["none","Which domains to default to shorter form(none|all|www)"],usemutation:["on-Y","Listen for mutation events(on|off),Use DOM4 Mutation Observer(Y|N)"],oneclick:["N-N","One-click blocking(Y|N),Goes to Perma-ban(Y|N)"],runbeta:["N","Enable incompletely tested features (Y|N)"],reserved2:["X","Y"]},GM4?GM.getValue("ghhprefs","").then((function(value){ghhPrefs=value,checkprefs(),GHHbDinit()})):(ghhPrefs=GM_getValue("ghhprefs",""),checkprefs(),GHHbDinit());var t_ap,t_gimg,parentcard,ignoreNodeNames="|BODY|#text|#comment|INPUT|BUTTON|SCRIPT|LI|A|FORM|",ignoreIds="|leftnav|leftnavc|foot|ghhtemp|ghhblockform|ghhmanageform|ghhsitelist|ghhpbanlist|rhs|rhscol|",ignoreClass="|ghhider|ghhdbuttons|ghh1time|";function checkOlist(e){// Check for new results // Needed for Baidu
var el=e.target;
// Ignore events on some elements
if(!(ignoreNodeNames.indexOf("|"+el.nodeName+"|")>-1||el.hasAttribute("id")&&ignoreIds.indexOf("|"+el.id+"|")>-1)){if(el.hasAttribute("class")){if(ignoreClass.indexOf("|"+el.className+"|")>-1)return;if(el.classList.contains("goog-date"))return}document.getElementById("ghhmngform")||(addManageForm(),injectBaseCSS(),injectCustom(),document.getElementById("ghhMngBtn")||"blk"==mbstyle.split("-")[0]||('Google'==engine?document.getElementById("res")&&addMngBtn():addMngBtn()),
// Use default button style for now (1.9.3)
GHHbD_addStyle("#ghhMngBtn {position:fixed;top:150px;right:-2.8em;-moz-transform:rotate(-90deg);-webkit-transform:rotate(-90deg);border-bottom:0;border-bottom-left-radius:0;border-bottom-right-radius:0;padding:6px 1px;z-index:1000;}")),checkNode(el)}}function checkNode(el){if(!el.parentNode||'ghhsitelist'!=el.parentNode.id&&'ghhpbanlist'!=el.parentNode.id){if(// 2.0.6 duh!
// AutoPager extension
document.querySelector("#navcnt")&&(t_ap&&window.clearTimeout(t_ap),t_ap=window.setTimeout(refreshListeners,500)),"LI"==el.nodeName||"DIV"==el.nodeName&&("g"==el.className||el.classList.contains("rg_di")||"rgsh"==el.className)||'G-INNER-CARD'==el.nodeName||'G-CARD'==el.nodeName||el.classList.contains("isv-r"))var nlist=[el];else nlist=el.querySelectorAll('li.g, div.g, div.rg_di, div.isv-r');if('Google'!=engine&&"LI"!=el.nodeName&&(nlist="DIV"==el.nodeName&&(el.classList.contains("result--web")||el.classList.contains("result--news")||"card-mobile"==el.className)?[el]:el.querySelectorAll('div.result, div.result-op, div.links_main, div.serp-item, div.hd, li.b_algo, ol.list-flat > li, div.card-web div.card-mobile')),nlist.length>0)hidehits(nlist,!!isch),document.getElementById("GTR")&&removePBs();else if("DIV"==el.nodeName&&(el.classList.contains("irc_c")||el.classList.contains("irc_bg")||'irc_bg'==el.id))for(var buttondivs=el.querySelectorAll('.irc_butc:not([ghhresult]), .irc_but_r:not([ghhresult]), .irc_ab:not([ghhresult]), .irc_but_pdfr:not([ghhresult])'),k=0;k<buttondivs.length;k++)if(buttondivs[k].setAttribute("ghhresult","image-unset"),buttondivs[k].style.position="relative",'TABLE'==buttondivs[k].nodeName){var tdnew=document.createElement("td");tdnew.innerHTML='<button type="button" title="Block/Unblock" class="irc_but"><span class="irc_but_t">GHHbD</span></button>',buttondivs[k].querySelector('tr').appendChild(tdnew),tdnew.firstChild.addEventListener("click",imgblockdialog,!1)}else{var spannew=document.createElement("span");spannew.style.marginLeft='10px',spannew.innerHTML='<button type="button" title="Block/Unblock" class="irc_but"><span class="irc_but_t">GHHbD</span></button>',buttondivs[k].appendChild(spannew),spannew.firstChild.addEventListener("click",imgblockdialog,!1)}else{var abtn=el.querySelectorAll('a[role="button"][href]');// Google images sidebar 2020-06-20
if(abtn.length>0&&null!=abtn[0].closest('c-wiz'))var alnk=abtn[0].closest('c-wiz').querySelector('a[role="link"][href]');if(alnk&&!alnk.parentNode.hasAttribute('ghhresult')){alnk.parentNode.setAttribute('ghhresult','image-unset');var dnew=document.createElement("div");dnew.setAttribute('style','text-align: right'),dnew.innerHTML='<button type="button" title="Block/Unblock" url="'+alnk.href+'" style="position:relative; top: 5em; right: 6px; z-index: 1000; color: #609beb; background-color: #333; border: 1px solid  #609beb;">GHHbD</button>',alnk.parentNode.insertBefore(dnew,alnk),dnew.firstChild.addEventListener("click",imgblockdialog,!1)}}0===document.querySelectorAll('style.GHHbDcss').length&&(// Bing losing styles... 2018-10-01
injectBaseCSS(),doSiteSpecific(),GHHbD_addStyle("#ghhMngBtn {position:fixed;top:150px;right:-2.8em;-moz-transform:rotate(-90deg);-webkit-transform:rotate(-90deg);border-bottom:0;border-bottom-left-radius:0;border-bottom-right-radius:0;padding:6px 1px;z-index:1000;}"))}}function hidehits(liels,ovrd){if((liels||(liels='Google'==engine?document.querySelectorAll("#res li.g, #res div.srg div.g, #res div._NId div.g, #res div._bkWMgd div.g, #res #rso div.g, #res #GTR div.g, #res #isr_mc, g-section-with-header g-scrolling-carousel g-inner-card, g-card div.dbsr, g-card"):document.querySelectorAll('div#results li, div#results > div.result, div#links > div.results_links_deep > div.links_main, div#b_content ol > li.b_algo, div#results div#web > ol > li, div#WS2m > div.w, div.sw-CardBase, div.serp-list > div.serp-item, ul.serp-list > li.serp-item, div#main_results > div.result, div.results-column div.result--web, div.results-column div.result--news, #content_left > div.result.c-container, #content_left > div.result-op.c-container, ol.list-flat > li, div.w-gl__result, div.card-web div.card-mobile')))&&(isch&&0==liels.length?liels=document.querySelectorAll('div.rg_di, div.isv-r'):0==liels.length&&(liels='Google'==engine?document.querySelectorAll("#res li.g, #res div.srg div.g, #res div._NId div.g, #res div._bkWMgd div.g, #res #rso div.g, #res #GTR div.g, #res #isr_mc, g-section-with-header g-scrolling-carousel g-inner-card, g-card div.dbsr, g-card"):document.querySelectorAll('div#results li, div#results > div.result, div#links > div.results_links_deep > div.links_main, div#b_content ol > li.b_algo, div#results div#web > ol > li, div#WS2m > div.w, div.sw-CardBase, div.serp-list > div.serp-item, ul.serp-list > li.serp-item, div#main_results > div.result, div.results-column div.result--web, div.results-column div.result--news, #content_left > div.result.c-container, #content_left > div.result-op.c-container, ol.list-flat > li, div.w-gl__result, div.card-web div.card-mobile')),0!=liels.length)){var hosts,hiders,nhider,i,j,k,hid,ael,ahref,dom,dompart,btn,apar,dgone;for(1==liels.length&&"isr_mc"==liels[0].id&&(liels=liels[0].querySelectorAll(".rg_di")),hosts=blist,i=0;i<liels.length;i++)if(("OL"==liels[i].parentNode.nodeName||"TD"==liels[i].parentNode.nodeName||liels[i].classList.contains("card-section")||liels[i].classList.contains("ct-cs")||liels[i].classList.contains("w-gl__result")||"DIV"==liels[i].parentNode.nodeName&&(liels[i].parentNode.classList.contains("srg")||liels[i].parentNode.classList.contains("_NId")||liels[i].parentNode.parentNode.classList.contains("_NId")||liels[i].parentNode.classList.contains("bkWMgd")||liels[i].parentNode.parentNode.classList.contains("bkWMgd")||'G-INNER-CARD'===liels[i].nodeName||'G-CARD'===liels[i].nodeName)||"DIV"==liels[i].parentNode.nodeName&&null!==liels[i].closest('#rso')||'Google'!=engine&&"DIV"==liels[i].parentNode.nodeName||liels[i].classList.contains('serp-item'))&&0!=liels[i].className.indexOf("gbt")&&!1===liels[i].classList.contains("gplusgrid")&&!1===liels[i].classList.contains("mitem")&&!1===liels[i].classList.contains("kno-kp")){if(liels[i].setAttribute("ghhresult","unset"),(0==(nhider=(hiders=liels[i].getElementsByClassName("ghhider")).length)||1==ovrd)&&(// skip if a button is there
hid=!1,// first link (not useful for video or book blocks), <h3> preferred
(ael=liels[i].querySelector("div.r > a, h3 a, div.rc a"))&&'deeplink_title'!=ael.parentNode.className||(ael=liels[i].querySelector("h2 a, h4 a")),ael||(ael=liels[i].querySelector("a")),liels[i].classList.contains("videobox")&&(ael=liels[i].querySelectorAll("td")[1].querySelector("a")),//video page
'Google'==engine&&location.search.indexOf('adtest=on')>-1&&(ael=liels[i].querySelector('cite'))&&(ael.hasAttribute('href')||(-1===ael.textContent.indexOf('http://')&&-1===ael.textContent.indexOf('https://')?ael.setAttribute('href','http://'+ael.textContent):ael.setAttribute('href',ael.textContent))),'Baidu'==engine&&(liels[i].hasAttribute('mu')&&liels[i].insertAdjacentHTML('beforeend','<span style="display:none"><a class="c-showurl" href="'+liels[i].getAttribute('mu')+'">'+liels[i].getAttribute('mu')+'</a></span>'),(ael=liels[i].querySelector("a.c-showurl"))&&(ael.hasAttribute('href')||(-1===ael.textContent.indexOf('http://')&&-1===ael.textContent.indexOf('https://')?ael.setAttribute('href','http://'+ael.textContent):ael.setAttribute('href',ael.textContent)))),'Startpage'==engine&&(ael=liels[i].querySelector('a.result-link')),ael&&(ahref=ael.getAttribute("href"))&&(0==ahref.search(/http|ftp/i)||0==ahref.indexOf("/interstitial")||0==ahref.indexOf("/url?q=")||ahref.indexOf(currentG+"/url?q=")>-1||0==ahref.indexOf("/url?sa=")||0==ahref.indexOf("/aclk?")&&liels[i].classList.contains("psli")||0==ahref.indexOf("//r.search.yahoo")||ahref.indexOf(currentG+"/link?url=")>-1))){for(dom=ahref.substr(ahref.search(/http|ftp/i)),ael.hasAttribute("data-href")&&(dom=ael.getAttribute("data-href").substr(ael.getAttribute("data-href").indexOf("http"))),dom.indexOf(currentG+"/aclk?")>-1&&(dom=ahref.substr(ahref.indexOf("http",10))),ahref.indexOf("/url?sa=")>-1&&(dom=decodeURIComponent(ahref.substr(ahref.indexOf("&url=")+5))),ahref.indexOf("r.search.yahoo.com/_ylt=")>-1&&(dom=decodeURIComponent(ahref.substr(ahref.indexOf("RU=http")+3))),dom.indexOf("search.yahoo.co.jp/r/FOR=")>-1&&(dom=decodeURIComponent(ahref.substr(ahref.indexOf("/**http")+3))),dom.indexOf("https://ixquick-proxy.com/do/spg/highlight.pl")>-1&&(dom=decodeURIComponent(ahref.substr(ahref.indexOf("&u=http")+3))),currentG.indexOf("baidu")>-1&&(dom='//'+ael.textContent.replace('https://','').replace('http://','').replace('....','')),(
// if (dom.indexOf("imgrefurl")>-1) dom = dom.match(/imgrefurl=([^&]+)/)[1];
dom=dom.split("/")[2]).indexOf(":")>-1&&(dom=dom.substr(0,dom.indexOf(":"))),// Strip port number
dompart=dom,liels[i].setAttribute("ghhhost",dompart);dompart.indexOf(".")>-1;){if(hosts.indexOf("|"+dompart+":")>-1){// These domains suck
if(nhider>0)// Remove old buttons, notices, etc.
for(k=hiders.length-1;k>=0;k--)hiders[k].remove(),nhider=liels[i].getElementsByClassName("ghhider").length;if(!1===liels[i].classList.contains("ghh1time"))for(hosts.indexOf("|"+dompart+":p")<0?// Regular block
"Y"==showYN?liels[i].classList.contains("results_links_deep")?// DDG
replaceHit(dompart,ael,liels[i].querySelector(".links_main"),""):replaceHit(dompart,ael,liels[i],""):replaceHit(dompart,ael,liels[i],"none"):(// Perma-ban
liels[i].setAttribute("blockhidden",dompart),'Google'!=engine&&!1===liels[i].classList.contains("ghhdnone")&&(liels[i].classList.add('ghhdnone'),liels[i].classList.contains("links_main")&&liels[i].parentNode.classList.add('ghhdnone'))),kids='DDG'==engine&&liels[i].classList.contains("results_links_deep")?liels[i].lastElementChild.children:liels[i].children,j=0;j<kids.length;j++)// Hide Google result
!1===kids[j].classList.contains("ghhider")&&!1===kids[j].classList.contains("ghhdnone")&&kids[j].classList.add('ghhdnone');liels[i].classList.contains("psli")&&(liels[i].style.padding="0"),// Shopping results
hid=!0;break}-1===(dompart=dompart.slice(dompart.indexOf(".")+1)).indexOf(".")&&"tld"!=dompart&&(dompart+='.tld')}if(0==hid&&nhider>1&&(// Remove previous block & reset nhider
liels[i].children[0].classList.contains("ghhd")&&liels[i].children[0].remove(),
// Clean up unblocked one-times
liels[i].classList.contains("ghh1time")&&(liels[i].classList.remove('ghh1time'),(dgone=liels[i].getElementsByClassName("ghhd")).length>0&&dgone[0].remove(),(dgone=liels[i].getElementsByClassName("ghhdbuttons")).length>0&&dgone[0].remove()),nhider=liels[i].getElementsByClassName("ghhider").length),0==hid&&(0==nhider||'g-section-with-header'==liels[i].children[0].nodeName.toLowerCase())){for(// Not blocked, insert block button
// First, remove hiding for unblocked domains
kids='DDG'==engine&&liels[i].classList.contains("results_links_deep")?liels[i].lastElementChild.children:liels[i].children,j=0;j<kids.length;j++)kids[j].classList.contains("ghhdnone")&&kids[j].classList.remove('ghhdnone');if(liels[i].hasAttribute("blockhidden")&&(liels[i].removeAttribute("blockhidden"),liels[i].classList.remove('ghhdnone'),'DDG'==engine&&liels[i].classList.contains("links_main")&&liels[i].parentNode.classList.remove('ghhdnone')),liels[i].hasAttribute("blocknotice")&&liels[i].removeAttribute("blocknotice"),liels[i].parentNode.hasAttribute("blocknotice")&&liels[i].parentNode.removeAttribute("blocknotice"),//DDG
// Insert block button
apar=ael,'Google'==engine&&(location.search.indexOf('adtest=on')>-1?(apar=liels[i].querySelector("h3 a, a")).hasAttribute('hreforiginal')||apar.setAttribute('hreforiginal',ael.getAttribute('href')):apar.hasAttribute('hreforiginal')||apar.setAttribute('hreforiginal',apar.href)),'Baidu'==engine&&((apar=liels[i].querySelector("h3 a, .c-result-content a"))||null==liels[i].querySelector("p.op_site_domain_title, div.op_generalqa_main.c-row")||(apar=liels[i].querySelector("p.op_site_domain_title, div.op_generalqa_main.c-row").firstChild)),null==apar||apar.nextElementSibling||"LI"!=apar.parentNode.nodeName&&"TD"!=apar.parentNode.nodeName&&"H2"!=apar.parentNode.nodeName&&(apar=apar.parentNode),null!=apar&&null!=apar&&dom.indexOf(currentG)<0&&liels[i].parentNode!=document.querySelector("#tads ol")&&liels[i].parentNode!=document.querySelector("#bottomads ol")&&liels[i].parentNode!=document.querySelector("#ads div")&&liels[i].parentNode!=document.querySelector("#rhs ol")){
// Move button to citeline 6/10/2013; updated 8/16/2020 to look for action-menu first
if((btn=document.createElement("button")).appendChild(document.createTextNode(txts.block[0])),btn.className="ghhider ghhb",btn.setAttribute("meta",dom),"Y"==pref1click.substr(0,1)&&"Y"==mbstyle.split("-")[4]?//BUG: for 1-click with aggressive (subdomain) settings, dom will be incorrect
'Google'==engine?btn.setAttribute("title","Block "+dom+" / SHIFT+click to display block form / ALT+click to omit"):btn.setAttribute("title","Block "+dom+" / SHIFT+click to display block form"):"Y"==mbstyle.split("-")[4]&&('Google'==engine?btn.setAttribute("title","Block "+dom+" / Show block form / ALT+click to omit"):btn.setAttribute("title","Block "+dom+" / Show block form")),btn.addEventListener("click",showbfd,!0),
// Position button inside the H2 or H3 or H4
"H3"==apar.nodeName||"H2"==apar.nodeName||"H4"==apar.nodeName||'Startpage'==engine?(apar.style.overflow="visible",apar.appendChild(btn),
// full link text tooltip
'Yahoo'==engine&&'SPAN'==apar.querySelector('a').childNodes[0].nodeName?apar.querySelector('a').setAttribute("title",apar.querySelector('a').childNodes[1].textContent):apar.querySelector('a').setAttribute("title",apar.querySelector('a').textContent)):'G-CARD'==apar.parentNode.parentNode.nodeName?(apar.parentNode.appendChild(btn),apar.parentNode.parentNode.style.overflowY='visible',apar.parentNode.parentNode.style.height='unset',apar.parentNode.parentNode.style.position='relative'):'dbsr'==apar.parentNode.className?(apar.parentNode.appendChild(btn),(parentcard=apar.closest('g-card'))&&(parentcard.style.overflowY='visible',parentcard.style.position='relative')):apar.nextSibling?apar.parentNode.insertBefore(btn,apar.nextSibling):apar.parentNode.appendChild(btn),"C"==bbpos){var axnmenu=liels[i].querySelector(".action-menu"),citelines=liels[i].querySelectorAll("cite");if(axnmenu)// parentNode is a span
axnmenu.parentNode.insertBefore(btn,axnmenu),citelines.length>0&&(axnmenu.parentNode.className=citelines[0].className);else{for(var citenum=0;citenum<citelines.length;citenum++)"hidden"!=window.getComputedStyle(citelines[citenum]).visibility?(citelines[citenum].parentNode.appendChild(btn),btn.removeAttribute("style"),'Google'==engine&&(btn.style.visibility='visible')):(// add to visibility:hidden element for spacing
citelines[citenum].parentNode.appendChild(btn.cloneNode(!0)),'Google'==engine&&(btn.style.visibility='hidden'));
// Startpage.com
(citelines=liels[i].querySelectorAll('.w-gl__result-url-container')).length>0&&(citelines[0].appendChild(btn),btn.removeAttribute("style"))}}
// Implement Mouseover Option 6/22/2012
// Avoid unhiding garbage span 5/25/2012
for("M"==bbstyle&&(btn.style.visibility="hidden",liels[i].addEventListener("mouseover",togglebbtn,!1),liels[i].addEventListener("mouseout",togglebbtn,!1)),j=0;j<liels[i].children.length;j++)!1===liels[i].children[j].classList.contains("ghhider")&&"none"==liels[i].children[j].style.display&&liels[i].children[j].setAttribute("wasdisplaynone","wasdisplaynone")}}}}else// Check for and handle Google standard image results - doesn't yet support BASIC image results
if(liels[i].classList.contains("rg_di")||liels[i].classList.contains("isv-r")){if((!liels[i].hasAttribute("imgblock")||1==ovrd)&&(// skip if previously processed
liels[i].setAttribute("imgblock","normal"),(ael=liels[i].querySelector('a[href*="."]'))&&-1==ael.href.indexOf('/search?')&&(// Site showing the image ("visit page")
dom=ael.getAttribute("href").indexOf("imgrefurl")>-1?decodeURIComponent(ael.href).match(/imgrefurl=([^&]+)/)[1].split("/")[2]:ael.getAttribute("href").indexOf("imgurl")>-1?decodeURIComponent(ael.href).match(/imgurl=([^&]+)/)[1].split("/")[2]:ael.getAttribute("href").split("/")[2]).length>0))for(dom.indexOf(":")>-1&&(dom=dom.substr(0,dom.indexOf(":"))),// Strip port number
dompart=dom;dompart.indexOf(".")>-1;){if(hosts.indexOf("|"+dompart+":")>-1){// These domains suck
hosts.indexOf("|"+dompart+":p")<0?// Regular block
liels[i].setAttribute("imgblock","regular"):// Perma-ban
liels[i].setAttribute("imgblock","pban");break}-1===(dompart=dompart.slice(dompart.indexOf(".")+1)).indexOf(".")&&"tld"!=dompart&&(dompart+='.tld')}!1}if(!document.getElementById("ghhMngBtn")&&"blk"!=mbstyle.split("-")[0]&&document.getElementById("res")&&addMngBtn(),document.getElementsByClassName("unbtn").length>1&&undupMngBtn(),"Y"==betatest&&'Google'==engine){// BETA - NEW - v1.5.2
// If there are more than two completely invisible results, modify the query to exclude the first hidden site
var invis=document.querySelectorAll("li[blockhidden]");invis.length>=3&&reQry("+-site:"+invis[0].getAttribute("blockhidden"))}}}function fixImagesLayout(){
// BUGGY: REPLACEMENT IMAGES DO NOT LOAD UNTIL YOU TRIGGER A REPAINT (e.g., open/close Find bar, resize window, zoom in then zoom out)
var madeamove=!1,rgshes=document.querySelectorAll(".rgsh"),lastdatapg=rgshes[rgshes.length-1].getAttribute("data-pg"),badimg=document.querySelectorAll('div[imgblock="pban"]');
// TODO: Create setting to let user choose to remove regular blocks, too; temporary workaround: uncomment the following line:
// var badimg = document.querySelectorAll('div[imgblock="pban"],div[imgblock="regular"]');
if(badimg.length>0){for(var bi=0;bi<badimg.length;bi++)badimg[bi].hasAttribute("newdatapg")?// already moved
badimg[bi].getAttribute("newdatapg")!=lastdatapg&&(document.getElementById("rg_s").appendChild(badimg[bi]),badimg[bi].setAttribute("newdatapg",lastdatapg),madeamove=!0):(// first move
document.getElementById("rg_s").appendChild(badimg[bi]),badimg[bi].setAttribute("newdatapg",lastdatapg),madeamove=!0);
// Trigger Google's function to re-layout the results neatly
if(madeamove){var sctag=document.createElement("script");sctag.setAttribute("type","text/javascript"),sctag.appendChild(document.createTextNode("google.isr.layoutInit();")),document.body.appendChild(sctag)}}}function replaceHit(sdomain,oa,oli,ddis){var fc,dnew,dset,btn;(fc=oli.querySelector('h3, h2'))||(fc=oli.firstChild),"DIV"==fc.nodeName&&fc.classList.contains("ghhider")||(dnew=document.createElement("div"),oa.querySelector('h3')?dnew.appendChild(document.createTextNode(oa.querySelector('h3').textContent+" on "+sdomain)):'G-INNER-CARD'===oli.nodeName||'G-CARD'===oli.nodeName||'dbsr'===oli.className?(oa.children[1]?dnew.appendChild(document.createTextNode(oa.children[1].textContent+" on "+sdomain)):oa.children[0]&&oa.children[0].children[1]&&oa.children[0].children[1].children[1]&&dnew.appendChild(document.createTextNode(oa.children[0].children[1].children[1].textContent+" on "+sdomain)),dnew.style.whiteSpace='normal'):'Yahoo'==engine&&'SPAN'==oa.childNodes[0].nodeName?dnew.appendChild(document.createTextNode(oa.childNodes[1].textContent+" on "+sdomain)):dnew.appendChild(document.createTextNode(oa.textContent+" on "+sdomain)),dnew.className="ghhider ghhd",dnew.setAttribute("title","Click to view, unblock or Perma-ban"),dnew.style.display=ddis,"none"==ddis?(oli.setAttribute("blockhidden",sdomain),oli.hasAttribute("blocknotice")&&oli.removeAttribute("blocknotice")):(oli.setAttribute("blocknotice",sdomain),oli.hasAttribute("blockhidden")&&oli.removeAttribute("blockhidden"),oli.classList.remove('ghhdnone'),oli.parentNode.classList.contains("results_links_deep")&&(oli.parentNode.setAttribute("blocknotice",sdomain),oli.parentNode.hasAttribute("blockhidden")&&oli.parentNode.removeAttribute("blockhidden"),oli.parentNode.classList.remove('ghhdnone'))),dnew.addEventListener("click",reshow,!1),
// dnew is disappearing on Bing in Chrome TODO: FIXIT
'dbsr'===oli.className?(parentcard=oa.closest('g-card'))&&parentcard.insertBefore(dnew,parentcard.firstChild):oli.insertBefore(dnew,oli.firstChild),(dset=document.createElement("div")).className="ghhider ghhindent",dset.setAttribute("dom",sdomain),dset.style.display="none",(btn=document.createElement("button")).appendChild(document.createTextNode(txts.unblock[0])),btn.className="ghhider",btn.setAttribute("title","Unblock this site"),btn.style.backgroundColor="#9f6",btn.addEventListener("click",unblock,!1),dset.appendChild(btn),(btn=document.createElement("button")).appendChild(document.createTextNode(txts.pban[0])),btn.className="ghhider",btn.setAttribute("title","Permanently hide this site"),btn.style.backgroundColor="#f66",btn.addEventListener("click",permban,!1),dset.appendChild(btn),(btn=document.createElement("button")).appendChild(document.createTextNode("close")),btn.className="ghhider",btn.setAttribute("title","Re-hide this hit"),btn.style.backgroundColor="#eee",btn.addEventListener("click",rehide,!1),dset.appendChild(btn),dnew.appendChild(dset),"hidden"!=dnew.parentNode.style.overflow&&"hidden"!=dnew.parentNode.style.overflowX||dnew.insertBefore(document.createElement("br"),dnew.firstChild),dset.addEventListener("click",ghhkillevent,!1),oli.classList.contains("psli")&&(dnew.style.margin="1em 0"))}function hidebasic(tbl){// BASIC IMAGE RESULTS, BETA ONLY, NON-AJAX
var hosts,tds,i,ael,dom,dompart;for(hosts=blist,tds=tbl.querySelectorAll("td"),i=0;i<tds.length;i++)if((ael=tds[i].querySelector("a"))&&ael.hasAttribute("href")&&ael.getAttribute("href").indexOf("imgrefurl=")>-1)for((dom=ael.getAttribute("href").substr(ael.getAttribute("href").indexOf("imgrefurl=")+7).split("/")[2]).indexOf(":")>-1&&(dom=dom.substr(0,dom.indexOf(":"))),// Strip port number
dompart=dom;dompart.indexOf(".")>-1;){if(hosts.indexOf("|"+dompart+":")>-1){// These domains suck; mark the cell for now
hosts.indexOf("|"+dompart+":p")>-1||"N"==showYN?tds[i].setAttribute("ghhaction","delete"):tds[i].setAttribute("ghhaction","notice");break}-1===(dompart=dompart.slice(dompart.indexOf(".")+1)).indexOf(".")&&"tld"!=dompart&&(dompart+='.tld')}for(i=0;i<tds.length;i++)switch(tds[i].getAttribute("ghhaction")){case"delete":
// TODO implement deletion
tds[i].innerHTML="delete cell";break;case"notice":
// TODO implement clickable notices
tds[i].style.textDecoration="line-through",tds[i].style.opacity="0.3"}}
// == == == Other Functions == == ==
function reshow(e){// Show hit without unblocking
var liel,ael,dabs,k;if(liel=e.target.closest('[ghhresult]')){for(liel.classList.add('ghh1time'),
// Hide notice, move action buttons, then show hit
e.target.style.display="none",!(ael=liel.querySelector("div.r > a, h3 a, .c-result-content a"))&&'Baidu'==engine&&liel.hasAttribute('mu')&&(ael=liel.querySelector("p.op_site_domain_title, div.op_generalqa_main.c-row").firstChild),ael||(ael=liel.querySelector("span.tl a")),// summarized news result
ael||(ael=liel.querySelector("a")),// other
liel.classList.contains("videobox")&&(ael=liel.querySelectorAll("td")[1].querySelector("a")),//video page
dabs=e.target.firstElementChild,'Bing'!=engine?(ael.parentNode.classList.contains('ghh1time')?ael.parentNode.insertBefore(dabs,ael.nextSibling):'G-INNER-CARD'===ael.parentNode.parentNode.nodeName||'G-CARD'===ael.parentNode.parentNode.nodeName?ael.parentNode.parentNode.insertBefore(dabs,ael.parentNode):ael.parentNode.nextSibling?ael.parentNode.parentNode.insertBefore(dabs,ael.parentNode.nextSibling):ael.parentNode.parentNode.appendChild(dabs),dabs.className="ghhdbuttons",dabs.removeAttribute("style"),dabs.nextElementSibling&&(0!=dabs.nextElementSibling.className.indexOf("ghhider")&&"block"!=dabs.nextElementSibling.innerHTML||dabs.parentNode.removeChild(dabs.nextElementSibling))):(
// TODO dabs is disappearing on Bing when moved -- temporarily, don't move it
e.target.style.display='',dabs.className="ghhdbuttons",dabs.removeAttribute("style")),k=1;k<liel.children.length;k++)liel.children[k].classList.remove('ghhdnone');e.stopPropagation()}}
// Hide or Show hit notices
async function updtpref(e){var hds,s;"Y"==showYN?confirm("No longer show titles or buttons for suppressed results?")&&(ghhPrefO.shownotc[0]="N",GM4?await GM.setValue("ghhprefs",JSON.stringify(ghhPrefO)):GM_setValue("ghhprefs",JSON.stringify(ghhPrefO)),showYN=ghhPrefO.shownotc[0],togHiderDivs("no")):(s=(hds=document.getElementsByClassName("ghhd")).length>0?1==hds.length?"is 1 blocked hit":"are "+hds.length+" blocked hits":"are no blocked hits",confirm("Show titles and buttons for suppressed results? (There "+s+" on this page.)")&&(ghhPrefO.shownotc[0]="Y",GM4?await GM.setValue("ghhprefs",JSON.stringify(ghhPrefO)):GM_setValue("ghhprefs",JSON.stringify(ghhPrefO)),showYN=ghhPrefO.shownotc[0],togHiderDivs("yes"))),fixShowHideBtn(),e.target.blur()}function fixShowHideBtn(){var chkMP=document.getElementById("chkshownotc"),chkBF=document.getElementById("chkshownotcbf");"Y"==showYN?(chkMP.setAttribute("checked","checked"),chkMP.checked=!0,chkBF&&(chkBF.setAttribute("checked","checked"),chkBF.checked=!0)):(chkMP.removeAttribute("checked"),chkMP.checked=!1,chkBF&&(chkBF.removeAttribute("checked"),chkBF.checked=!1))}function togHiderDivs(sShow){var dh,i;for(dh=document.getElementsByClassName("ghhider"),i=0;i<dh.length;i++)"DIV"==dh[i].nodeName&&!1===dh[i].classList.contains("ghhindent")&&(dh[i].style.display="yes"==sShow?"":"none")}
// Remove domain from the block list
async function unblock(e){var elPar,sdom,slist,liel;if(!(sdom=(elPar=e.target.parentNode).getAttribute("dom"))||sdom.length<4)alert("Problem with domain to unblock");else{if("|"!=(slist=GM4?await GM.getValue("hideyhosts"):GM_getValue("hideyhosts")).substr(0,1)&&(slist="|"+slist),slist=slist.replace("|"+sdom+":t",""),GM4?await GM.setValue("hideyhosts",slist):GM_setValue("hideyhosts",slist),blist=slist,needupdate=!0,("LI"==(liel=elPar.closest('[ghhresult]')).nodeName||"DIV"==liel.nodeName)&&liel.classList.contains("ghh1time")){liel.classList.remove('ghh1time');var ghhds=liel.getElementsByClassName("ghhd");ghhds.length>0&&ghhds[0].remove(),elPar.remove()}hidehits(null,!0),document.getElementById("ghhmngform")&&"block"==document.getElementById("ghhmngform").style.display&&refreshSiteList()}}
// Add domain to the Perma-ban list
async function permban(e){var dpar,sdom,slist,liel;confirm("Never see hits for this domain again?")&&(sdom=(dpar=e.target.parentNode).getAttribute("dom"),"|"!=(slist=GM4?await GM.getValue("hideyhosts"):GM_getValue("hideyhosts")).substr(0,1)&&(slist="|"+slist),slist=slist.replace("|"+sdom+":t","|"+sdom+":p"),GM4?await GM.setValue("hideyhosts",slist):GM_setValue("hideyhosts",slist),blist=slist,needupdate=!0,(liel=dpar.closest('[ghhresult]'))||alert('Developer error in permban (no liel)'),"LI"!=liel.nodeName&&"DIV"!=liel.nodeName&&'G-INNER-CARD'!=liel.nodeName&&'G-CARD'!=liel.nodeName||!liel.classList.contains("ghh1time")||liel.classList.remove('ghh1time'),dpar.classList.contains("ghhindent")&&(dpar=dpar.parentNode),dpar.remove(),hidehits(null,!0),document.getElementById("GTR")&&removePBs(),document.getElementById("ghhmngform")&&"block"==document.getElementById("ghhmngform").style.display&&refreshSiteList())}
// Close this bad result and rehide (to allow indendent open/close, do not run through hidehits)
function rehide(e){var dpar,liel,dompart,ael,j;for((liel=(dpar=e.target.parentNode).closest('[ghhresult]'))||alert('Developer error in rehide (no liel)'),dompart=dpar.getAttribute("dom"),'Bing'!=engine?(dpar.remove(),liel.removeChild(liel.querySelector("div.ghhd"))):
// TODO notice is disappearing on Bing -- temporarily, do not move/remove the buttons div
liel.querySelector('div.ghhd > div.ghhdbuttons').style.display='none',(ael=liel.querySelector("h3 a, h2 a"))||(ael=liel.querySelector("a")),liel.classList.remove('ghh1time'),replaceHit(dompart,ael,liel,""),j=0;j<liel.children.length;j++)// Hide Google result
!1===liel.children[j].classList.contains("ghhider")&&!1===liel.children[j].classList.contains("ghhdnone")&&liel.children[j].classList.add('ghhdnone')}
// Functions relating to the Block form
function addBlockForm(){var bfd=document.createElement("div");bfd.id="ghhblockform",bfd.className="ghhpane";var bfdcode="<form onsubmit=\"return false;\"><p style=\"margin:0.75em 0;\"><strong>Add to blocklist:</strong></p><p><label style=\"white-space:pre\"><input type=\"radio\" name=\"ghhdom\" value=\"f\"> <span id=\"ghhfulldom\"></span></label><br><label><input type=\"radio\" name=\"ghhdom\" value=\"p\"> <span id=\"ghhpartdom\"></span>  <button type=\"button\" id=\"ghhdomadj\" title=\"Adjust partial domain\" style=\"position: absolute; right: 1em; padding: 0 1px;\">~</button></label></p><p style=\"text-align:center;white-space:pre;line-height:2em;margin:0.75em 0\"><button type=\"button\" id=\"ghhbf1\" bt=\"t\"> "+txts.okbtn[0]+' </button> <button type="button" id="ghhbf3" bt="p"> '+txts.okPbtn[0]+" </button><br><button type=\"button\" id=\"ghhbf2\" mng=\"N\"> "+txts.cancelbtn[0]+" </button> <button type=\"button\" id=\"ghhbf4\" mng=\"Y\">"+txts.cancelMbtn[0]+'</button></p>';'Google'==engine&&(bfdcode+="<p style=\"border-top:1px solid #aaa;text-align:center;white-space:pre;line-height:2em;margin:0.75em 0;padding-top:0.5em;\">Edit query: <button type=\"button\" id=\"ghhbf5\" title=\"This site only\"> +site: </button> <button type=\"button\" id=\"ghhbf6\" title=\"Exclude this site\"> -site: </button></p>"),bfdcode+="<p style=\"margin:0.75em 0;\"><label title=\"Switch between showing and hiding result titles for regular blocked hits\"><input type=\"checkbox\" name=\"chkshownotcbf\" id=\"chkshownotcbf\"> Show hidden hit notices</label><br><label title=\"Switch between block dialog and one-click blocking\"><input type=\"checkbox\" name=\"chk1clickbf\" id=\"chk1clickbf\"> Enable 1-click blocking</label></p></form>",bfd.innerHTML=bfdcode,document.body.appendChild(bfd),document.getElementById("ghhbf1").addEventListener("click",addblock,!1),document.getElementById("ghhbf2").addEventListener("click",ghhcloseform,!1),document.getElementById("ghhbf3").addEventListener("click",addblock,!1),document.getElementById("ghhbf4").addEventListener("click",ghhcloseform,!1),'Google'==engine&&(document.getElementById("ghhbf5").addEventListener("click",reQuery,!1),document.getElementById("ghhbf6").addEventListener("click",reQuery,!1)),document.getElementById("ghhblockform").addEventListener("click",ghhkillevent,!1),document.getElementById("chkshownotcbf").addEventListener("change",updtpref,!1),document.getElementById("chk1clickbf").addEventListener("change",updt1click,!1),document.getElementById("ghhdomadj").addEventListener("click",adjpartdom,!1)}function showbfd(e){var bbtn,bfdiv,fdom,pdom,fspan,pspan,tdiv,lt;if(fdom=(bbtn=e.target).getAttribute("meta"),document.getElementById("ghhblockform")||addBlockForm(),(fspan=document.getElementById("ghhfulldom")).textContent=fdom,fspan.previousElementSibling.checked=!0,pdom=fdom.substr(fdom.indexOf(".")+1),pspan=document.getElementById("ghhpartdom"),pdom.indexOf(".")>-1&&1!=patIPv4.test(fdom)){switch(pspan.textContent=pdom,pspan.parentNode.style.display="",bAggress){case'all':pspan.previousElementSibling.checked=!0;break;case'www':'www'==fdom.substr(0,3)&&(pspan.previousElementSibling.checked=!0)}document.getElementById("ghhdomadj").style.display=''}else pspan.parentNode.style.display="none",document.getElementById("ghhdomadj").style.display='none';if(1!=e.altKey||'Google'!=engine){if(bfdiv=document.getElementById("ghhblockform"),(tdiv=document.getElementById("ghhtemp"))||((tdiv=document.createElement("div")).id="ghhtemp"),1==isch?(tdiv.setAttribute("style","position:absolute;right:0;top:4em;z-index:3000;width:250px;"),bbtn.parentNode.appendChild(tdiv)):'G-INNER-CARD'==e.target.parentNode.parentNode.nodeName||'G-CARD'==e.target.parentNode.parentNode.nodeName?(tdiv.setAttribute("style","position:absolute;left:8px;top:8px;z-index:9999;width:100%;"),e.target.parentNode.parentNode.insertBefore(tdiv,e.target.parentNode.parentNode.children[0])):'G-INNER-CARD'==e.target.parentNode.nodeName||'G-CARD'==e.target.parentNode.nodeName||'dbsr'==e.target.parentNode.className?(tdiv.setAttribute("style","position:absolute;left:8px;top:8px;z-index:9999;width:100%;"),e.target.parentNode.insertBefore(tdiv,e.target.parentNode.children[0])):'Google'==engine&&'C'==bbpos?(tdiv.setAttribute("style","position:absolute;left:8px;top:16px;z-index:9999;width:100%;"),e.target.parentNode.style.position='relative',e.target.parentNode.insertBefore(tdiv,e.target.parentNode.children[0])):(lt=bbtn.offsetLeft+bbtn.offsetWidth+12,bbtn.parentNode.previousElementSibling&&("none"!=window.getComputedStyle(bbtn.parentNode.previousElementSibling,null).getPropertyValue("float")||"absolute"==bbtn.style.position&&"TD"==bbtn.parentNode.nodeName)&&(lt-=bbtn.parentNode.offsetLeft),document.querySelector('table#GTR')&&(lt-=230),'Google'!=engine&&(lt-=bbtn.parentNode.offsetLeft),'Startpage'==engine&&(lt=16),tdiv.setAttribute("style","position:relative;left:"+lt+"px;top:-65px;z-index:500;width:250px;"),bbtn.nextElementSibling&&("DIV"==bbtn.nextElementSibling.nodeName||"BR"==bbtn.nextElementSibling.nodeName)?bbtn.parentNode.insertBefore(tdiv,bbtn.nextElementSibling):bbtn.parentNode.appendChild(tdiv)),tdiv.appendChild(bfdiv),"hidden"!=window.getComputedStyle(tdiv.parentNode).overflowX&&"hidden"!=window.getComputedStyle(tdiv.parentNode).overflowY||(tdiv.parentNode.style.overflowX="visible",tdiv.parentNode.style.overflowY="visible"),"Y"==pref1click.substr(0,1)&&1!=e.shiftKey&&1!=isch)// 1-click; hold Shift to override
"N"==pref1click.substr(2,1)?document.getElementById("ghhbf1").click():document.getElementById("ghhbf3").click();else{// regular + populating 1-click checkbox
var chkBF=document.getElementById("chk1clickbf");"Y"==pref1click.substr(0,1)?(chkBF.setAttribute("checked","checked"),chkBF.checked=!0):(chkBF.removeAttribute("checked"),chkBF.checked=!1),chkBF=document.getElementById("chkshownotcbf"),"Y"==showYN?(chkBF.setAttribute("checked","checked"),chkBF.checked=!0):(chkBF.removeAttribute("checked"),chkBF.checked=!1),bfdiv.style.display="block",document.getElementById("ghhbf1").focus()}e.stopPropagation()}else reQuery()}function adjpartdom(e){// v1.8.1
var pspan=document.getElementById("ghhpartdom"),parts=pspan.textContent.replace('...','').split(".");parts.length<=2&&(2==parts.length&&0!==parts[1].indexOf('tld [all')?
// offer the entire TLD option v1.9.9
parts.push('tld [all dot-'+parts[1]+'\'s]'):
// cycle back to the original partial domain
parts=document.getElementById("ghhfulldom").textContent.split(".")),parts.shift(),// discard leftmost subdomain
pspan.textContent=parts.join(".")}async function addblock(e){var btype,els,i,sdom,tgt;for(btype=(tgt=e.target).getAttribute("bt"),els=tgt.form.querySelectorAll('input[type="radio"]'),i=0;i<els.length;i++)if(1==els[i].checked){sdom=els[i].nextElementSibling.textContent.split(" ")[0];break}ghhcloseform(e),"|"!=blist.substr(0,1)&&(blist="|"+blist),btype||(btype="t"),"end"==addAt?blist+=sdom+":"+btype+"|":blist="|"+sdom+":"+btype+blist,needupdate=!0,GM4?await GM.setValue("hideyhosts",blist):GM_setValue("hideyhosts",blist),hidehits(null,!0),document.getElementById("GTR")&&removePBs(),"sort"==addAt&&sortlist(null),document.getElementById("ghhmngform")&&"block"==document.getElementById("ghhmngform").style.display&&refreshSiteList()}async function ghhcloseform(e){if(e){if("object"==typeof e&&e.target){if(0==e.target.id.indexOf("ghhbf")){var mng=e.target.getAttribute("mng"),bfdiv=document.getElementById("ghhblockform"),tdiv=document.getElementById("ghhtemp");bfdiv.style.display="none",document.body.appendChild(bfdiv),tdiv.remove(),"Y"==mng&&showManageForm("mngform")}0==e.target.id.indexOf("ghhmf")&&("mng"==mbstyle.split("-")[0]&&toggleBlockHiders("H"),document.getElementById("ghhmngform").style.display="none","Y-Y"==mpopen.substr(0,3)&&(mpopen="Y-N",ghhPrefO.mngpaneopen[0]=mpopen,GM4?await GM.setValue("ghhprefs",JSON.stringify(ghhPrefO)):GM_setValue("ghhprefs",JSON.stringify(ghhPrefO))))}else"mngform"==e&&("mng"==mbstyle.split("-")[0]&&toggleBlockHiders("H"),document.getElementById("ghhmngform").style.display="none","Y-Y"==mpopen.substr(0,3)&&(mpopen="Y-N",ghhPrefO.mngpaneopen[0]=mpopen,GM4?await GM.setValue("ghhprefs",JSON.stringify(ghhPrefO)):GM_setValue("ghhprefs",JSON.stringify(ghhPrefO))));e.stopPropagation()}}async function imgblockdialog(e){var viewer=e.target.closest('[ghhresult]');if(viewer){var ael=viewer.parentNode.children[0].querySelector('._r3 a[href], span > a[href]');// Aug. 2019 design
if(ael||(ael=viewer.querySelector('a[href]')),ael){var ameta=ael.href.split("/")[2];ael.href.indexOf("&url=")>-1&&(ameta=decodeURIComponent(ael.href).match(/&url=([^&]+)/)[1].split("/")[2]),ameta.indexOf(":")>-1&&(ameta=ameta.substr(0,ameta.indexOf(":"))),// Strip port number
e.target.setAttribute("meta",ameta);for(var dompart=ameta;dompart.indexOf(".")>-1;){if(blist.indexOf("|"+dompart+":")>-1){if(confirm("Unblock "+dompart+"?")){if(GM4)slist=await GM.getValue("hideyhosts");else var slist=GM_getValue("hideyhosts");"|"!=slist.substr(0,1)&&(slist="|"+slist),slist=slist.replace("|"+dompart+":t","").replace("|"+dompart+":p",""),GM4?await GM.setValue("hideyhosts",slist):GM_setValue("hideyhosts",slist),blist=slist,needupdate=!0,hidehits(null,!0),document.getElementById("ghhmngform")&&"block"==document.getElementById("ghhmngform").style.display&&refreshSiteList()}return void e.stopPropagation()}dompart=dompart.slice(dompart.indexOf(".")+1)}showbfd(e)}else alert('Cannot find the URL in this design.')}}
// Functions relating to the Manage Hiding button
function addMngBtn(){var mbtn;"blk"!=mbstyle.split("-")[0]&&(window.self!=window.top&&"ifrN"==mbstyle.split("-")[1]||((mbtn=document.createElement("button")).appendChild(document.createTextNode(txts.mngbtn[0])),mbtn.className="ghhider unbtn",mbtn.setAttribute("title","Manage Google Hit Hider Settings"),mbtn.id="ghhMngBtn",mbtn.addEventListener("click",showManageForm,!0),document.body.appendChild(mbtn)))}function undupMngBtn(){for(var unbtns=document.getElementsByClassName("unbtn");unbtns.length>1;)unbtns[unbtns.length-1].parentNode.removeChild(unbtns[unbtns.length-1])}async function showManageForm(e){if(window.self==window.top){var mfd;if(document.getElementById("ghhmngform")||addManageForm(),"none"!=(mfd=document.getElementById("ghhmngform")).style.display&&"mngform"!=e)// Toggle to hidden
"mng"==mbstyle.split("-")[0]&&toggleBlockHiders("H"),"Y-Y"==mpopen.substr(0,3)&&(mpopen="Y-N",ghhPrefO.mngpaneopen[0]=mpopen,GM4?await GM.setValue("ghhprefs",JSON.stringify(ghhPrefO)):GM_setValue("ghhprefs",JSON.stringify(ghhPrefO))),mfd.style.display="none";else{if(1==needupdate&&refreshSiteList(),mfd.style.display="block","Y-Y"==mpopen.substr(0,3)&&5==mpopen.length){// Restore last displayed tab
var tabnum=mpopen.substr(4,1);if("none"==document.getElementById('ghhmt'+tabnum).style.display)return togglelist('ghhts'+tabnum),"mng"==mbstyle.split("-")[0]&&toggleBlockHiders("S"),void("object"==typeof e&&e.target.blur())}"none"!=document.getElementById("ghhmt1").style.display||"none"!=document.getElementById("ghhmt4").style.display?(document.getElementById("ghhmf1").setAttribute("disabled","disabled"),document.getElementById("ghhutil").style.display="none"):(document.getElementById("ghhmf1").hasAttribute("disabled")&&document.getElementById("ghhmf1").removeAttribute("disabled"),"N"!=bLUopen&&(document.getElementById("ghhutil").style.display="block")),setCurrentTab(),"mng"==mbstyle.split("-")[0]&&toggleBlockHiders("S")}"object"==typeof e&&e.target.blur()}}function setCurrentTab(){var k,tabnum,tabset=document.querySelectorAll("#mflists>div");for(k=0;k<tabset.length;k++)tabnum=(tabnum=tabset[k].getAttribute("id")).substr(tabnum.length-1),"none"!=tabset[k].style.display?(document.getElementById("ghhts"+tabnum).className="ghhCurTab","Y"==mpopen.substr(0,1)&&(mpopen="Y-Y-"+tabnum,ghhPrefO.mngpaneopen[0]=mpopen,GM4?/* NOT SYNCHRONOUS */
GM.setValue("ghhprefs",JSON.stringify(ghhPrefO)):GM_setValue("ghhprefs",JSON.stringify(ghhPrefO)))):document.getElementById("ghhts"+tabnum).className=""}
// Functions relating to the Manage GHH form
function addManageForm(){var mfd=document.createElement("div");mfd.id="ghhmngform",mfd.className="ghhpane",mfd.setAttribute("style","display:none;"),mfd.innerHTML="<form onsubmit=\"return false;\"><div id=\"ghhtsdiv\"><p style=\"margin:6px 0 -1px 0\" id=\"ghhtstrip\"><button type=\"button\" id=\"ghhts1\" title=\"General Use and Notices\">Home</button><button type=\"button\" id=\"ghhts2\" title=\"Regular Block List\">Block</button><button type=\"button\" id=\"ghhts3\" title=\"Perma-ban List\">Perma-ban</button><button type=\"button\" id=\"ghhts4\" title=\"Manage Script Options\">Options</button></p></div><div id=\"mflists\" style=\"width:230px\"><div id=\"ghhmt1\"><p>Welcome to Google Hit Hider! <a href=\"https://www.jeffersonscher.com/gm/google-hit-hider/\" style=\"float:right;\" target=\"_blank\" title=\"Documentation\">JS</a></p><div class=\"ghhtab\"><p style=\"padding:0.25em;margin:0.25em\">Click the block button ( <button type=\"button\" class=\"ghhider\" onclick=\"return false;\">"+txts.block[0]+"</button> ) next to a hit title to block results from that site. A <b>regular</b> blocked hit becomes a one-line notation, while a <b>Perma-ban</b> disappears completely.</p><p style=\"border-top:1px solid #000; padding:0.25em;margin:0.25em\"><label title=\"Switch between showing and hiding result titles for regular blocked hits\"><input type=\"checkbox\" name=\"chkshownotc\" id=\"chkshownotc\"> Show hidden hit notices</label><br><label title=\"Switch between block dialog and one-click blocking\"><input type=\"checkbox\" name=\"chk1click\" id=\"chk1click\"> Enable 1-click blocking</label></p><p style=\"border-top:1px solid #000; padding:0.25em;margin:0.25em\">v2.2.1 &copy; 2021 Jefferson Scher. Learn more on <a href=\""+script_about+"\">this script's page</a>.</p></div></div><div id=\"ghhmt2\" style=\"display:none\"><p>Click to remove from regular block list:</p><div class=\"ghhtab\"><ul id=\"ghhsitelist\"></ul></div></div>\n<div id=\"ghhmt3\" style=\"display:none\"><p>Click to remove from Perma-ban list:</p><div class=\"ghhtab\"><ul id=\"ghhpbanlist\"></ul></div></div><div id=\"ghhmt4\" style=\"display:none\"><p>Manage script options:</p><div class=\"ghhtab\" id=\"btnedit\"><p id=\"addradios\">Add newly blocked domains:<br><label><input type=\"radio\" name=\"addpos\" value=\"end\"> at the end of the list</label><br><label><input type=\"radio\" name=\"addpos\" value=\"top\"> at the top of the list</label><br><label><input type=\"radio\" name=\"addpos\" value=\"sort\"> in alphabetical order</label></p><p id=\"aggressrads\" style=\"border-top:1px solid #000;padding-top:0.25em;margin-bottom:8px\">Block form defaults to:<br><label><input type=\"radio\" name=\"agglevel\" value=\"none\"> always the full domain</label><br><label><input type=\"radio\" name=\"agglevel\" value=\"all\"> always the partial domain</label><br><label><input type=\"radio\" name=\"agglevel\" value=\"www\"> partial domain for www only</label></p><p id=\"btnradios\" style=\"border-top:1px solid #000;padding-top:0.25em;margin-bottom:8px\">User interface style:<br><label><input type=\"radio\" name=\"uistyle\" value=\"both\"> Show Manage Hiding &amp; "+txts.block[0]+"</label><br><label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type=\"checkbox\" name=\"mbiframe\" id=\"mbiframe\"> Manage Hiding in iframes</label><br><label title=\"You can click a "+txts.block[0]+" button to open this dialog\"><input type=\"radio\" name=\"uistyle\" value=\"blk\"> Hide Manage Hiding button</label><br><label title=\""+txts.block[0]+" buttons will appear only when this dialog is displayed\"><input type=\"radio\" name=\"uistyle\" value=\"mng\"> Hide "+txts.block[0]+" buttons</label><br><span style=\"display:inline-block;margin-top:4px;\">Manage Hiding button position:</span><br><label><input type=\"radio\" name=\"mngbtnpos\" value=\"R\"> Side</label> <label><input type=\"radio\" name=\"mngbtnpos\" value=\"T\"> Top</label> <label><input type=\"radio\" name=\"mngbtnpos\" value=\"B\"> Bottom</label><br><span style=\"display:inline-block;margin-top:4px;\">Block button position <i>(reloads)</i>:</span><br><label><input type=\"radio\" name=\"blockposit\" value=\"H\"> Headline</label> <label><input type=\"radio\" name=\"blockposit\" value=\"C\"> Cite line</label><br><span style=\"display:inline-block;margin-top:4px;\">Display block buttons:</span><br><label><input type=\"radio\" name=\"blockdisp\" value=\"P\"> Always</label> <label><input type=\"radio\" name=\"blockdisp\" value=\"M\"> On Mouseover</label><br><span style=\"display:inline-block;margin-top:4px;\">Block button tooltips:</span><br><label><input type=\"radio\" name=\"blockttip\" value=\"Y\"> Full Detail</label> <label><input type=\"radio\" name=\"blockttip\" value=\"N\"> None</label></p><p id=\"miscpref\" style=\"border-top:1px solid #000;padding-top:0.25em;margin-bottom:8px\">Misc Preferences:<br><label><input type=\"checkbox\" name=\"chkajax\" id=\"chkajax\"> Instant/AJAX/Autopager</label><br><label><input type=\"checkbox\" name=\"chkdom4\" id=\"chkdom4\"> DOM4 Mutation Observer</label><br><label><input type=\"checkbox\" name=\"chkmpopen\" id=\"chkmpopen\"> Re-open Management Pane</label><br><label><input type=\"checkbox\" name=\"chk1pban\" id=\"chk1pban\"> 1-click to Perma-ban list</label><br><label title=\"Try out features that haven't been completely tested\"><input type=\"checkbox\" name=\"chkbeta\" id=\"chkbeta\"> Enable beta features</label></p><p style=\"border-top:1px solid #000;padding-top:0.25em;margin-bottom:8px\">Edit captions:</p><p><button type=\"button\" class=\"ghhider\" id=\"ghhedit1\" key=\"block\">"+txts.block[0]+"</button> <button type=\"button\" class=\"ghhider\" id=\"ghhedit3\" key=\"unblock\" style=\"background:#9f6\">"+txts.unblock[0]+"</button> <button type=\"button\" class=\"ghhider\" id=\"ghhedit2\" key=\"pban\" style=\"background:#f66\">"+txts.pban[0]+"</button></p><p><i>Reload to complete changes</i></p><p><button type=\"button\" id=\"ghhmfr\">Restore default captions</button></p><p style=\"border-top:1px solid #000;padding-top:0.25em;margin-bottom:8px\">Custom style rules:<br><button type=\"button\" id=\"ghhecsr\">Edit Custom Style Rules</button></p></div></div></div><p style=\"text-align:center;white-space:pre;margin:1em 0\"><button type=\"button\" id=\"ghhmf1\">"+txts.savebtn[0]+"<span id=\"numchgs\"></span></button> <button type=\"button\" id=\"ghhmf3\" title=\"Display additional buttons for list management\">List Util <div style=\"display:inline;font-size:0.9em;color:#888\"><span id=\"ghhdowntriangle\">&#9660;</span><span id=\"ghhuptriangle\" style=\"display:none\">&#9650;</span></div></button> <button type=\"button\" id=\"ghhmf2\">"+txts.closebtn[0]+"</button></p><p id=\"ghhutil\" style=\"display:none\"><button type=\"button\" id=\"ghhmf4\" title=\"Display block list for copying to backup or share\">"+txts.eximbtn[0]+"</button> <button type=\"button\" id=\"ghhmf7\" title=\"Import domains to the block list\">"+txts.impobtn[0]+"</button> <button type=\"button\" id=\"ghhmf8\" title=\"Add all domains on this page to current list\">"+txts.addallbtn[0]+"</button><br /><button type=\"button\" id=\"ghhmf5\" title=\"Sort list in alphabetical order\">"+txts.sortbtn[0]+"</button> <button type=\"button\" id=\"ghhmf6\" title=\"De-duplicate block list by removing unnecessary domains\">"+txts.dedupbtn[0]+"</button> <button type=\"button\" id=\"ghhmf9\" title=\"Remove www from blocked domains\">"+txts.unwwwbtn[0]+"</button></p></form>",document.body.appendChild(mfd),fixShowHideBtn(),fixuistyle(),fixaddpos(),fixaggblock(),fixajaxstyle(),fixpanepersist(),fix1clickstyle(),fixBeta(),document.getElementById("ghhts1").addEventListener("click",togglelist,!0),// tabs
document.getElementById("ghhts2").addEventListener("click",togglelist,!0),document.getElementById("ghhts3").addEventListener("click",togglelist,!0),document.getElementById("ghhts4").addEventListener("click",togglelist,!0),document.getElementById("chkshownotc").addEventListener("change",updtpref,!0),// home
document.getElementById("chk1click").addEventListener("change",updt1click,!0),document.getElementById("ghhsitelist").addEventListener("click",togglesite,!0),// block
document.getElementById("ghhpbanlist").addEventListener("click",togglesite,!0),// pban
document.getElementById("addradios").addEventListener("change",updtaddpos,!0),// options
document.getElementById("aggressrads").addEventListener("change",updtaggress,!0),document.getElementById("chkajax").addEventListener("change",updtAJAX,!0),document.getElementById("chkdom4").addEventListener("change",updtAJAX,!0),document.getElementById("chkmpopen").addEventListener("change",updtpersist,!0),document.getElementById("chk1pban").addEventListener("change",updt1click,!0),document.getElementById("chkbeta").addEventListener("change",updtBeta,!0),document.getElementById("btnradios").addEventListener("change",updtuistyle,!0),document.getElementById("ghhedit1").addEventListener("click",chgcaption,!0),document.getElementById("ghhedit2").addEventListener("click",chgcaption,!0),document.getElementById("ghhedit3").addEventListener("click",chgcaption,!0),document.getElementById("ghhmfr").addEventListener("click",resetTextStrings,!0),document.getElementById("ghhecsr").addEventListener("click",openCustomStyleBar,!0),document.getElementById("ghhmf1").addEventListener("click",saveedits,!0),// buttons
document.getElementById("ghhmf2").addEventListener("click",ghhcloseform,!0),document.getElementById("ghhmf3").addEventListener("click",toggleListUtil,!0),document.getElementById("ghhmf4").addEventListener("click",exportlist,!0),document.getElementById("ghhmf5").addEventListener("click",sortlist,!0),document.getElementById("ghhmf6").addEventListener("click",dedup,!0),document.getElementById("ghhmf7").addEventListener("click",importlist,!0),document.getElementById("ghhmf8").addEventListener("click",addAllNow,!0),document.getElementById("ghhmf9").addEventListener("click",unwww,!0),
// Add JS icon link
addBtnLink()}async function addBtnLink(){var JSBTN=document.createElement("img");JSBTN.setAttribute('alt','JS'),void 0===GM.getResourceUrl?JSBTN.src=GM_getResourceURL("mycon"):/* asynchronous*/
JSBTN.src=await GM.getResourceUrl("mycon"),document.querySelector("#ghhmt1 a").textContent="",document.querySelector("#ghhmt1 a").appendChild(JSBTN)}function togglelist(e){// Change tabs
if('string'==typeof e)var tgtid=e;else{if(e.target.blur(),"ghhCurTab"==e.target.className)return;tgtid=e.target.id}var k,tabnum,tabbtns=document.querySelectorAll("#ghhtstrip>button");for(k=0;k<tabbtns.length;k++)tabnum=(tabnum=tabbtns[k].id).substr(tabnum.length-1),tgtid==tabbtns[k].id?document.getElementById("ghhmt"+tabnum).style.display="":document.getElementById("ghhmt"+tabnum).style.display="none";"none"!=document.getElementById("ghhmt1").style.display||"none"!=document.getElementById("ghhmt4").style.display?(document.getElementById("ghhmf1").setAttribute("disabled","disabled"),document.getElementById("ghhutil").style.display="none"):(document.getElementById("ghhmf1").hasAttribute("disabled")&&document.getElementById("ghhmf1").removeAttribute("disabled"),"N"!=bLUopen&&(document.getElementById("ghhutil").style.display="block")),setCurrentTab()}function toggleListUtil(e){// Display/close extra set of buttons
e.target.blur();var p=document.getElementById("ghhutil");p&&(
// If not displaying a list now, move to a list
"none"!=document.getElementById("ghhmt1").style.display||"none"!=document.getElementById("ghhmt4").style.display?(togglelist('ghhts2'),p.style.display="block",// Always open button pane
bLUopen="Y",document.getElementById('ghhdowntriangle').style.display='none',document.getElementById('ghhuptriangle').style.display=''):"block"!=p.style.display?(// Toggle when list already was displayed
p.style.display="block",bLUopen="Y",document.getElementById('ghhdowntriangle').style.display='none',document.getElementById('ghhuptriangle').style.display=''):(p.style.display="none",bLUopen="N",document.getElementById('ghhdowntriangle').style.display='',document.getElementById('ghhuptriangle').style.display='none'))}function togglesite(e){// Designate list items for unblock, pban or block
var t,l,pid;switch("ghhinfo"==(t=e.target).className&&(t=t.nextElementSibling),pid=(l=t.parentNode).parentNode.id,t.className){case"ghhhost ghhpb":t.className="ghhhost ghhblk",// toggle to block
"LI"==l.nodeName&&("ghhsitelist"==pid?(l.children[0].style.display="none",listchgs-=1):(l.children[0].style.display="inline",l.children[0].textContent="to "+txts.block[0],l.children[0].style.backgroundColor="#ccc",listchgs+=1));break;case"ghhhost ghhdel":t.className="ghhhost ghhpb",// toggle to perma-ban
"LI"==l.nodeName&&("ghhpbanlist"==pid?(l.children[0].style.display="none",listchgs-=1):(l.children[0].style.display="inline",l.children[0].textContent="to "+txts.pban[0],l.children[0].style.backgroundColor="#f66"));break;default:t.className="ghhhost ghhdel",// toggle to unblock
"LI"==l.nodeName&&(l.children[0].style.display="inline",l.children[0].textContent="to "+txts.unblock[0],l.children[0].style.backgroundColor="#9f6","ghhsitelist"==pid&&(listchgs+=1))}}async function saveedits(e){// Save changes made on tabs 2 and 3
if(e)if(0==listchgs){if(!confirm("No changes detected. Save anyway?"))return void e.target.blur()}else if(!confirm("Save changes to block list?"))return void e.target.blur();var slist,i,sp,ttemp,ptemp;for(slist=document.getElementById("ghhsitelist"),ttemp="",ptemp="",i=0;i<slist.children.length;i++)if("LI"==slist.children[i].nodeName)switch((sp=slist.children[i].children[1]).className){case"ghhhost ghhblk":ttemp+=sp.textContent+":t|";break;case"ghhhost ghhpb":ptemp+=sp.textContent+":p|"}for(slist=document.getElementById("ghhpbanlist"),i=0;i<slist.children.length;i++)if("LI"==slist.children[i].nodeName)switch((sp=slist.children[i].children[1]).className){case"ghhhost ghhblk":ttemp+=sp.textContent+":t|";break;case"ghhhost ghhpb":ptemp+=sp.textContent+":p|"}GM4?(await GM.setValue("hideyhosts","|"+ttemp+ptemp),blist=await GM.getValue("hideyhosts")):(GM_setValue("hideyhosts","|"+ttemp+ptemp),blist=GM_getValue("hideyhosts")),hidehits(null,!0),refreshSiteList(),listchgs=0,e&&e.target.blur()}function refreshSiteList(){// Rebuild lists for tabs 2 and 3
var sarray,ulB,ulP,i,slist='',pblist='';for("|"!=blist.substr(0,1)&&(blist="|"+blist),sarray=blist.substr(1).split("|"),i=0;i<sarray.length-1;i++)sarray[i].indexOf(":p")<0?slist+='<li><span class="ghhinfo"></span><span class="ghhhost ghhblk">'+sarray[i].split(':')[0]+'</span></li>':pblist+='<li><span class="ghhinfo"></span><span class="ghhhost ghhpb">'+sarray[i].split(':')[0]+'</span></li>';for(ulB=document.getElementById("ghhsitelist");ulB.firstChild;)ulB.removeChild(ulB.firstChild);for(ulB.insertAdjacentHTML('beforeend',slist),ulP=document.getElementById("ghhpbanlist");ulP.firstChild;)ulP.removeChild(ulP.firstChild);ulP.insertAdjacentHTML('beforeend',pblist),needupdate=!1}async function updtaddpos(e){for(// Implement change for radio buttons re where to add to list
var rads=e.target.parentNode.querySelectorAll("input[type='radio']"),i=0;i<rads.length;i++)if(rads[i].checked){if("sort"==rads[i].value){if(!confirm("Sort lists now? Sorting is irreversible."))return void fixaddpos();if(listchgs>0){if(!confirm("You have unsaved changes to your lists. Save changes and sort, or cancel sorting?"))return void fixaddpos();saveedits(null)}sortlist(null)}addAt=rads[i].value,ghhPrefO.addtolistpos[0]=addAt,GM4?await GM.setValue("ghhprefs",JSON.stringify(ghhPrefO)):GM_setValue("ghhprefs",JSON.stringify(ghhPrefO));break}fixaddpos()}function fixaddpos(){for(// Check appropriate radio button re where to add to list
var rads=document.getElementById("addradios").querySelectorAll("input[type='radio']"),i=0;i<rads.length;i++)rads[i].value==addAt?(rads[i].setAttribute("checked","checked"),rads[i].checked=!0):rads[i].hasAttribute("checked")&&(rads[i].removeAttribute("checked"),rads[i].checked=!1)}async function updtaggress(e){for(// Implement change for radio buttons re default domain to block
var rads=e.target.parentNode.querySelectorAll("input[type='radio']"),i=0;i<rads.length;i++)if(rads[i].checked){bAggress=rads[i].value,ghhPrefO.aggressiveblock[0]=bAggress,GM4?await GM.setValue("ghhprefs",JSON.stringify(ghhPrefO)):GM_setValue("ghhprefs",JSON.stringify(ghhPrefO));break}fixaggblock()}function fixaggblock(){for(// Check appropriate radio button re default domain to block
var rads=document.getElementById("aggressrads").querySelectorAll("input[type='radio']"),i=0;i<rads.length;i++)rads[i].value==bAggress?(rads[i].setAttribute("checked","checked"),rads[i].checked=!0):rads[i].hasAttribute("checked")&&(rads[i].removeAttribute("checked"),rads[i].checked=!1)}async function updtuistyle(e){// Store settings for buttons to display
var mbparts=mbstyle.split("-");if(1==mbparts.length&&mbparts.push("ifrN"),2==mbparts.length&&mbparts.push("R"),3==mbparts.length&&mbparts.push("P"),4==mbparts.length&&mbparts.push("Y"),5==mbparts.length&&mbparts.push("H"),"mbiframe"==e.target.id)e.target.checked?mbparts[1]="ifrY":mbparts[1]="ifrN",mbstyle=mbparts.join("-"),ghhPrefO.mngbtnstyle[0]=mbstyle,GM4?await GM.setValue("ghhprefs",JSON.stringify(ghhPrefO)):GM_setValue("ghhprefs",JSON.stringify(ghhPrefO));else// Handle radio buttons
if("uistyle"==e.target.getAttribute("name")){for(var rads=e.target.parentNode.querySelectorAll("input[name='uistyle']"),i=0;i<rads.length;i++)if(rads[i].checked){switch(rads[i].value){case"blk":mbparts[0]=rads[i].value,document.getElementById("ghhMngBtn").remove(),alert("After you close the management pane, click any block button to open it again.");break;case"mng":confirm("Display block buttons only when this dialog is open?")?mbparts[0]="mng":e.target.checked=!1;break;default:mbparts[0]="both",document.getElementById("ghhMngBtn")||addMngBtn()}mbstyle=mbparts.join("-"),ghhPrefO.mngbtnstyle[0]=mbstyle,GM4?await GM.setValue("ghhprefs",JSON.stringify(ghhPrefO)):GM_setValue("ghhprefs",JSON.stringify(ghhPrefO));break}}else{for(// Handle Management Button position and block button display style
rads=e.target.parentNode.querySelectorAll("input[name='mngbtnpos']"),i=0;i<rads.length;i++)if(rads[i].checked){mbparts[2]=rads[i].value,mbstyle=mbparts.join("-"),ghhPrefO.mngbtnstyle[0]=mbstyle,GM4?await GM.setValue("ghhprefs",JSON.stringify(ghhPrefO)):GM_setValue("ghhprefs",JSON.stringify(ghhPrefO));break}for(rads=e.target.parentNode.querySelectorAll("input[name='blockdisp']"),i=0;i<rads.length;i++)if(rads[i].checked){mbparts[3]=rads[i].value,mbstyle=mbparts.join("-"),ghhPrefO.mngbtnstyle[0]=mbstyle,GM4?await GM.setValue("ghhprefs",JSON.stringify(ghhPrefO)):GM_setValue("ghhprefs",JSON.stringify(ghhPrefO));break}for(rads=e.target.parentNode.querySelectorAll("input[name='blockttip']"),i=0;i<rads.length;i++)if(rads[i].checked){mbparts[4]=rads[i].value,mbstyle=mbparts.join("-"),ghhPrefO.mngbtnstyle[0]=mbstyle,GM4?await GM.setValue("ghhprefs",JSON.stringify(ghhPrefO)):GM_setValue("ghhprefs",JSON.stringify(ghhPrefO));break}for(rads=e.target.parentNode.querySelectorAll("input[name='blockposit']"),i=0;i<rads.length;i++)if(rads[i].checked){mbparts[5]=rads[i].value,mbstyle=mbparts.join("-"),ghhPrefO.mngbtnstyle[0]=mbstyle,GM4?await GM.setValue("ghhprefs",JSON.stringify(ghhPrefO)):GM_setValue("ghhprefs",JSON.stringify(ghhPrefO)),window.location.reload();break}}fixuistyle()}function fixuistyle(){// Check appropriate radio button re buttons to display
1==mbstyle.split("-").length&&(mbstyle+="-ifrN-R-P-Y-H"),2==mbstyle.split("-").length&&(mbstyle+="-R-P-Y-H"),3==mbstyle.split("-").length&&(mbstyle+="-P-Y-H"),4==mbstyle.split("-").length&&(mbstyle+="-Y-H"),5==mbstyle.split("-").length&&(mbstyle+="-H");for(var rads=document.getElementById("btnradios").querySelectorAll("input[name^='uistyle']"),i=0;i<rads.length;i++)rads[i].value==mbstyle.split("-")[0]?(rads[i].setAttribute("checked","checked"),rads[i].checked=!0):rads[i].hasAttribute("checked")&&(rads[i].removeAttribute("checked"),rads[i].checked=!1);var chk=document.getElementById("mbiframe");for("ifrY"==mbstyle.split("-")[1]?(chk.setAttribute("checked","checked"),chk.checked=!0):(chk.removeAttribute("checked"),chk.checked=!1),rads=document.getElementById("btnradios").querySelectorAll("input[name^='mngbtnpos']"),i=0;i<rads.length;i++)rads[i].value==mbstyle.split("-")[2]?(rads[i].setAttribute("checked","checked"),rads[i].checked=!0):rads[i].hasAttribute("checked")&&(rads[i].removeAttribute("checked"),rads[i].checked=!1);for(rads=document.getElementById("btnradios").querySelectorAll("input[name^='blockdisp']"),i=0;i<rads.length;i++)rads[i].value==mbstyle.split("-")[3]?(rads[i].setAttribute("checked","checked"),rads[i].checked=!0):rads[i].hasAttribute("checked")&&(rads[i].removeAttribute("checked"),rads[i].checked=!1);for(rads=document.getElementById("btnradios").querySelectorAll("input[name^='blockttip']"),i=0;i<rads.length;i++)rads[i].value==mbstyle.split("-")[4]?(rads[i].setAttribute("checked","checked"),rads[i].checked=!0):rads[i].hasAttribute("checked")&&(rads[i].removeAttribute("checked"),rads[i].checked=!1);for(rads=document.getElementById("btnradios").querySelectorAll("input[name^='blockposit']"),i=0;i<rads.length;i++)rads[i].value==mbstyle.split("-")[5]?(rads[i].setAttribute("checked","checked"),rads[i].checked=!0):rads[i].hasAttribute("checked")&&(rads[i].removeAttribute("checked"),rads[i].checked=!1);toggleciteline(mbstyle.split("-")[5])}async function updtAJAX(e){// Store settings for AJAX preferences
var chk=e.target;"chkajax"==chk.id?chk.checked?(bAJAX="on",chgMon?chgMon.disconnect():document.body.removeEventListener("DOMSubtreeModified",checkOlist,!1),setMutationWatch()):(bAJAX="off",chgMon?chgMon.disconnect():document.body.removeEventListener("DOMSubtreeModified",checkOlist,!1)):chk.checked?(bMutOb="Y",chgMon||bAJAX&&(document.body.removeEventListener("DOMSubtreeModified",checkOlist,!1),setMutationWatch())):(bMutOb="N",chgMon&&chgMon.disconnect(),bAJAX&&(document.body.removeEventListener("DOMSubtreeModified",checkOlist,!1),setMutationWatch())),ghhPrefO.usemutation[0]=bAJAX+"-"+bMutOb,GM4?await GM.setValue("ghhprefs",JSON.stringify(ghhPrefO)):GM_setValue("ghhprefs",JSON.stringify(ghhPrefO)),fixajaxstyle()}function fixajaxstyle(){// Check boxes for AJAX preferences
var chk=document.getElementById("chkajax");"on"==bAJAX?(chk.setAttribute("checked","checked"),chk.checked=!0):(chk.removeAttribute("checked"),chk.checked=!1),chk=document.getElementById("chkdom4"),"Y"==bMutOb?(chk.setAttribute("checked","checked"),chk.checked=!0):(chk.removeAttribute("checked"),chk.checked=!1)}async function updtpersist(e){// Store setting for persistence preference
var chk=e.target;mpopen=chk.checked?"Y"+mpopen.substr(1):"N"+mpopen.substr(1),ghhPrefO.mngpaneopen[0]=mpopen,GM4?await GM.setValue("ghhprefs",JSON.stringify(ghhPrefO)):GM_setValue("ghhprefs",JSON.stringify(ghhPrefO)),fixpanepersist()}function fixpanepersist(){// Check box for persistence preference
var chk=document.getElementById("chkmpopen");"Y"==mpopen.substr(0,1)?(chk.setAttribute("checked","checked"),chk.checked=!0):(chk.removeAttribute("checked"),chk.checked=!1)}async function updt1click(e){// Store setting for 1-click preferences
var chk=e.target;pref1click="chk1click"==chk.id||"chk1clickbf"==chk.id?chk.checked?"Y"+pref1click.substr(1,2):"N"+pref1click.substr(1,2):chk.checked?pref1click.substr(0,2)+"Y":pref1click.substr(0,2)+"N",ghhPrefO.oneclick[0]=pref1click,GM4?await GM.setValue("ghhprefs",JSON.stringify(ghhPrefO)):GM_setValue("ghhprefs",JSON.stringify(ghhPrefO)),e.stopPropagation(),fix1clickstyle()}function fix1clickstyle(){// Check boxes for one-click preferences
var chkMP=document.getElementById("chk1click"),chkBF=document.getElementById("chk1clickbf");"Y"==pref1click.substr(0,1)?(chkMP.setAttribute("checked","checked"),chkMP.checked=!0,chkBF&&(chkBF.setAttribute("checked","checked"),chkBF.checked=!0)):(chkMP.removeAttribute("checked"),chkMP.checked=!1,chkBF&&(chkBF.removeAttribute("checked"),chkBF.checked=!1));var chk=document.getElementById("chk1pban");"Y"==pref1click.substr(2,1)?(chk.setAttribute("checked","checked"),chk.checked=!0):(chk.removeAttribute("checked"),chk.checked=!1)}async function updtBeta(e){// Store setting for runbeta preference
var chk=e.target;betatest=chk.checked?"Y":"N",ghhPrefO.runbeta[0]=betatest,GM4?await GM.setValue("ghhprefs",JSON.stringify(ghhPrefO)):GM_setValue("ghhprefs",JSON.stringify(ghhPrefO)),fixBeta()}function fixBeta(){// Check box for runbeta preference
var chk=document.getElementById("chkbeta");"Y"==betatest?(chk.setAttribute("checked","checked"),chk.checked=!0):(chk.removeAttribute("checked"),chk.checked=!1)}async function chgcaption(e){// Store button caption changes (but do not immediately refresh)
var btn,key,input;btn=e.target,key=e.target.getAttribute("key"),e.target.blur(),(input=prompt(txts[key][1],txts[key][0]))&&input.length>0&&input!=txts[key][0]&&(txts[key][0]=input.replace(/\"/g,"''"),btn.appendChild(document.createTextNode(txts[key][0])),btn.removeChild(btn.firstChild),GM4?await GM.setValue("textstrings",JSON.stringify(txts)):GM_setValue("textstrings",JSON.stringify(txts)))}async function resetTextStrings(e){// Reset buttons captions to defaults
confirm("Restore default button captions?")&&(txts=defaultTxts,GM4?await GM.setValue("textstrings",JSON.stringify(txts)):GM_setValue("textstrings",JSON.stringify(txts)),alert("Please reload to see the changes."),e.target.blur())}async function exportlist(e){// Display and populate export form, clean up from any prior use
document.getElementById("ghhexport")||insertExportForm();var expDiv=document.getElementById("ghhexport");if(document.getElementById("ghheximhead").innerHTML="Export Block List",document.getElementById("ghheximinfo1").innerHTML="These boxes display your current block list. <button type=\"button\" id=\"expgotopreimp\" style=\"display:none\">Show old block list (prior to last import)</button><br /><br />On the left, you have the list in its native format. By saving this format, you can preserve your regular/Perma-ban block decisions. <br /><br />On the right, you have a simple list of domains. This would be a good format for sharing your list with others.",GM4)currlist=await GM.getValue("hideyhosts");else var currlist=GM_getValue("hideyhosts");document.getElementById("ghhtaleft").value=currlist;var domList=currlist.substr(1).replace(/:[tp]\|/g,"\n");if(document.getElementById("ghhtaright").value=domList.replace(/\n*$/,""),GM4)preimpolist=await GM.getValue("hideyback","");else var preimpolist=GM_getValue("hideyback","");preimpolist.length>0&&(document.getElementById("expgotopreimp").addEventListener("click",exportoldlist,!0),document.getElementById("expgotopreimp").style.display=""),document.getElementById("ghhleftcontrols").style.display="none",document.getElementById("ghhrightcontrols").style.display="none",document.getElementById("ghhtbldiv").style.display="none","none"==document.getElementById("ghhtaright").style.display&&(document.getElementById("ghhtaright").style.display=""),expDiv.style.display="block",e.target.blur()}function insertExportForm(){var dNew;(dNew=document.createElement("div")).id="ghhexport",dNew.className="ghhpane",dNew.setAttribute("style","position:fixed;top:10px;left:5%;width:90%;z-index:10000;background:#ddd;padding:1em;font-size:1.25em;display:none;max-height:90vh;overflow-y:auto;"),dNew.innerHTML="<button type=\"button\" onclick=\"this.parentNode.style.display='none'\" style=\"float: right; margin: 0 0 4px 4px;\" class=\"ghhider\">Close</button><p style=\"margin-top:0; font-weight: bold;\" id=\"ghheximhead\"></p><p id=\"ghheximinfo1\"></p><div id=\"ghhleft\" style=\"width:49%;float:left\"><textarea id=\"ghhtaleft\" spellcheck=\"false\" style=\"width:100%;height:calc(90vh - 300px);overflow-y:scroll\"></textarea><div id=\"ghhleftcontrols\" style=\"clear:left;display:none\"><p><button type=\"button\" id=\"ghhexp1\">Parse List for Import</button></p></div></div><div id=\"ghhright\" style=\"width:49%;float:right\"><textarea id=\"ghhtaright\" spellcheck=\"false\" style=\"width:100%;height:calc(90vh - 300px);overflow-y:scroll\"></textarea><div id=\"ghhtbldiv\" style=\"height:calc(90vh - 300px);overflow-y:scroll;overflow-x:scroll;background:#fff;padding:4px 0 0 4px;border:1px solid #aac;margin-top:1px;display:none\"></div> <div id=\"ghhrightcontrols\" style=\"clear:right;display:none\"><p id=\"impradios\">Please review the above list for accuracy. If correct, add domains to: <br><label><input type=\"radio\" name=\"impbtype\" value=\"asis\">&nbsp;the list specified under Block Type</label> <br /><label><input type=\"radio\" name=\"impbtype\" value=\"t\">&nbsp;the regular block list</label> <br /><label><input type=\"radio\" name=\"impbtype\" value=\"p\">&nbsp;the Perma-ban list</label> &nbsp; <button type=\"button\" id=\"ghhexp2\">Import</button> &nbsp; <span style=\"float:right; font-style:italic; opacity:0.8;\">Replace entire blocklist:&nbsp;<input type=\"checkbox\" id=\"chkimporepl\"></span></p></div></div>",document.body.appendChild(dNew)}function importlist(e){// Display import form, clean up from any prior use
document.getElementById("ghhexport")||insertExportForm();var expDiv=document.getElementById("ghhexport");document.getElementById("ghheximhead").innerHTML='Import Block List',document.getElementById("ghheximinfo1").innerHTML="<strong>As a precaution in case something goes wrong, please use the <button type=\"button\" id=\"impgotoexp\">Export</button> feature to copy and save your current list as a backup.</strong> <br /><br />To begin, paste your list into the left box below. Then click the Parse List for Import button. This script can import a list in its own native format, or a plain list of domains with a separate domain on each line, or separated by spaces. (It also converts the Noise Reduction for Google and Google Domain Blocker formats.)",document.getElementById("ghhtaleft").value="",document.getElementById("ghhleftcontrols").style.display="",document.getElementById("ghhrightcontrols").style.display="none",document.getElementById("ghhexp1").addEventListener("click",parseList,!0),document.getElementById("impgotoexp").addEventListener("click",exportlist,!0),document.getElementById("ghhtaright").style.display="none",document.getElementById("ghhtbldiv").style.display="none",document.getElementById("chkimporepl").checked=!1,expDiv.style.display="block",e.target.blur()}function parseList(e){// Parse putative domain list and redisplay cleaned up
var txt,i,tbod,thd,rasis,lbpos,rbpos,sites=[],bHasTypes=0;if((txt=document.getElementById("ghhtaleft").value).length<4)alert("Block list too short!");else{for(document.getElementById("ghhtbldiv").innerHTML="",
// strip regex
txt=(txt=(txt=(txt=(txt=(
// clean up/convert domain list to pipe-delimited
txt=txt.replace(/(http|https):/g,"")).replace(/(,|\/|;)/g,"|")).replace(/\s+/g,"|")).replace(/\|+/g,"|")).replace(/[\<\>"'=#\!\u2018\u2019\(\)\{\}]/g,"")).replace(/(\+|\*|\$|\\)/g,"");txt.indexOf("[")>-1&&txt.indexOf("]")>-1;)if(lbpos=txt.indexOf("["),rbpos=txt.indexOf("]"),lbpos>0&&rbpos+1<txt.length)txt=txt.substring(0,lbpos)+txt.substring(rbpos+1);else{if(!(0==lbpos&&rbpos+1<txt.length))break;// for some reason, entire list is bracketed??
txt=txt.substring(rbpos+1)}for(txt.indexOf(":")>-1&&(bHasTypes=1),sites=txt.split("|"),i=0;i<sites.length;i++)sites[i].length>1&&(0==sites[i].indexOf(".")&&(sites[i]=sites[i].substr(1)),sites[i].indexOf("?")>-1&&(sites[i]=sites[i].substr(0,sites[i].indexOf("?"))),1==bHasTypes?sites[i].indexOf(":t")==sites[i].length-2||sites[i].indexOf(":p")==sites[i].length-2?sites[i]="<tr><td>"+sites[i].replace(":t","</td><td>regular").replace(":p","</td><td>Perma-ban")+"</td></tr>":(sites[i].indexOf(":")>-1&&(sites[i]=sites[i].substr(0,sites[i].indexOf(":"))),sites[i]="<tr><td>"+sites[i]+"</td><td>(unspecified)</td></tr>"):// Plain list
sites[i]="<tr><td>"+sites[i]+"</td></tr>");tbod="<tbody>\n"+sites.join("\n")+"</tbody>",0!=sites.length?(thd=1==bHasTypes?"<thead><tr><th>Domain</th><th>Block Type</th></tr></thead>":"<thead><tr><th>Domain</th></tr></thead>",document.getElementById("ghhtbldiv").innerHTML="<table cellspacing=\"0\" class=\"ghhtbl\" id=\"ghhparsed\">"+thd+tbod+"</table>",document.getElementById("ghhtbldiv").style.display="",rasis=document.getElementById("ghhrightcontrols").querySelectorAll("input[value='asis']")[0],1==bHasTypes?(rasis.hasAttribute("disabled")&&rasis.removeAttribute("disabled"),rasis.checked=!0,rasis.parentNode.style.color=""):(rasis.setAttribute("disabled","disabled"),rasis.parentNode.style.color="rgb(172, 168, 153)",document.getElementById("ghhrightcontrols").querySelectorAll("input[value='t']")[0].checked=!0),document.getElementById("ghhrightcontrols").style.display="block",document.getElementById("ghhexp2").addEventListener("click",doImport,!0),e.target.blur()):alert("Unable to parse the list, sorry.")}}async function doImport(e){// Add sites from cleaned up domain list to script block lists
var tbl,rads,i,typeRule,rows,dom,newDoms="";if(tbl=document.getElementById("ghhparsed"))if("none"!=tbl.parentNode.style.display){for(rads=document.getElementById("ghhrightcontrols").querySelectorAll("input[type='radio']"),i=0;i<rads.length;i++)if(rads[i].checked){typeRule=rads[i].value;break}for(rows=tbl.getElementsByTagName("tbody")[0].getElementsByTagName("tr"),i=0;i<rows.length;i++)if((dom=rows[i].children[0].textContent).lastIndexOf(".")<dom.length-2&&dom.indexOf(".")>0){switch(typeRule){case"asis":"Perma-ban"==rows[i].children[1].textContent?newDoms+=dom+":p|":newDoms+=dom+":t|";break;default:newDoms+=dom+":"+typeRule+"|"}rows[i].style.backgroundColor="#ff0"}else rows[i].style.backgroundColor="#f00";""!=newDoms&&(
// Back up current block list
GM4?await GM.setValue("hideyback",blist):GM_setValue("hideyback",blist),1==document.getElementById("chkimporepl").checked&&confirm("Delete current block list and replace it with domains you are importing? (To add to the current block list, click Cancel.)")&&(blist=""),""==blist?blist="|"+newDoms:blist+=newDoms,
// Persist updated block list
GM4?await GM.setValue("hideyhosts",blist):GM_setValue("hideyhosts",blist),"block"==document.getElementById("ghhmngform").style.display&&refreshSiteList(),hidehits(null,!0)),alert("Import of yellow-highlighted domains completed. Please check the Management Pane to view, sort, and/or de-duplicate your imported domains.")}else alert("Please start the import process again!");else alert("Unable to locate table of parsed domains!")}async function exportoldlist(e){// Display and populate export form with pre-import list
document.getElementById("ghhexport")||insertExportForm();var expDiv=document.getElementById("ghhexport");if(document.getElementById("ghheximhead").innerHTML="Export Old (Pre-Import) Block List",document.getElementById("ghheximinfo1").innerHTML="These boxes display your old block list from before the last import. <button type=\"button\" id=\"expgotoblist\">Show current block list</button><br /><br />On the left, you have the list in its native format. By saving this format, you can preserve your regular/Perma-ban block decisions. <br /><br />On the right, you have a simple list of domains. This would be a good format for sharing your list with others.",GM4)preimpolist=await GM.getValue("hideyback","");else var preimpolist=GM_getValue("hideyback","");document.getElementById("ghhtaleft").value=preimpolist;var domList=preimpolist.substr(1).replace(/:[tp]\|/g,"\n");document.getElementById("ghhtaright").value=domList.replace(/\n*$/,""),document.getElementById("expgotoblist").addEventListener("click",exportlist,!0),document.getElementById("ghhleftcontrols").style.display="none",document.getElementById("ghhrightcontrols").style.display="none",document.getElementById("ghhtbldiv").style.display="none","none"==document.getElementById("ghhtaright").style.display&&(document.getElementById("ghhtaright").style.display=""),expDiv.style.display="block",e.target.blur()}async function sortlist(e){// Alpha-sort block list
if(listchgs>0){if(!confirm("You have unsaved changes to your lists. Save changes and sort, or cancel sorting?"))return;saveedits(null)}"|"!=blist.substr(0,1)&&(blist="|"+blist);var sarray=blist.substr(1,blist.length-2).split("|");sarray.sort(),
// Persist sorted list
GM4?(await GM.setValue("hideyhosts","|"+sarray.join("|")+"|"),blist=await GM.getValue("hideyhosts")):(GM_setValue("hideyhosts","|"+sarray.join("|")+"|"),blist=GM_getValue("hideyhosts")),refreshSiteList(),e&&e.target.blur()}async function dedup(e){// De-duplicate block lists
if(confirm("If you block example.com, you don't also need to block www.example.com. Remove unnecessary domains from the block list?")){var barray,i,j,iadd,smain,stest,sremd="",sques="";for("|"!=blist.substr(0,1)&&(blist="|"+blist),barray=blist.substr(1,blist.length-2).split("|"),i=0;i<barray.length;i++)barray[i].indexOf(":t")>-1?barray[i]=barray[i].substr(0,barray[i].indexOf(":")).split(".").reverse().join(".")+"!t":barray[i].indexOf(":p")>-1?barray[i]=barray[i].substr(0,barray[i].indexOf(":")).split(".").reverse().join(".")+"!p":barray[i]=barray[i].split(".").reverse().join(".")+"!t";for(barray.sort(),i=0;i<barray.length-1;i++){for(iadd=0,j=1;j<barray.length-i&&0==barray[i+j].indexOf(barray[i].substr(0,barray[i].length-2))&&(smain=barray[i].substr(0,barray[i].length-2).split(".").reverse().join("."),!((stest=barray[i+j].substr(0,barray[i+j].length-2).split(".").reverse().join(".")).indexOf(smain)<0));j++)barray[i].substr(barray[i].length-1)==barray[i+j].substr(barray[i+j].length-1)?(blist=blist.replace(stest+":"+barray[i+j].substr(barray[i+j].length-1)+"|",""),sremd+="|Removed: "+stest+"; Covered by: "+smain,iadd+=1):sques+="|Didn't remove "+(stest+="t"==barray[i+j].substr(barray[i+j].length-1)?" (regular)":" (permaban)")+" due to block type difference from "+(smain+="t"==barray[i].substr(barray[i].length-1)?" (regular)":" (permaban)");i+=iadd}GM4?await GM.setValue("hideyhosts",blist):GM_setValue("hideyhosts",blist),refreshSiteList(),
// ToDo: Alerts are temporary; nicer display "some day"
""!=sremd&&alert(sremd.substr(1).replace(/\|/g,"\n")),""!=sques&&alert(sques.substr(1).replace(/\|/g,"\n")),""==sremd&&""==sques&&alert("No unnecessary domains found."),e&&e.target.blur()}}async function unwww(e){// Remove www from beginnings of domains
confirm("You can block other subdomains on example.com by removing www from the beginning (e.g., blog.example.com). Update the block list?")&&("|"!=blist.substr(0,1)&&(blist="|"+blist),blist=blist.replace(/\|www\./g,"|"),GM4?await GM.setValue("hideyhosts",blist):GM_setValue("hideyhosts",blist),refreshSiteList(),e&&e.target.blur())}
// Misc functions
function convertFormat(){GM4||(//Legacy only
"|"!=blist.substr(0,1)&&(blist="|"+blist),blist="|"+blist.slice(1).replace(/\|/g,":t|"),GM_setValue("hideyhosts",blist))}function convertTxts(strTxts){var oldTxts;oldTxts=JSON.parse(strTxts),txts=defaultTxts,GM4||(//Legacy only
-1==txtsPref.indexOf(":[")?(// 0.8x to 0.9x+
txts.block[0]=oldTxts.block,txts.unblock[0]=oldTxts.unblock,txts.pban[0]=oldTxts.pban,txts.okbtn[0]=oldTxts.okbtn,txts.cancelbtn[0]=oldTxts.cancelbtn,txts.savebtn[0]=oldTxts.savebtn,txts.closebtn[0]=oldTxts.closebtn):(// 0.9x to 1.1x+
txts.block[0]=oldTxts.block[0],txts.unblock[0]=oldTxts.unblock[0],txts.pban[0]=oldTxts.pban[0],txts.okbtn[0]=oldTxts.okbtn[0],txts.cancelbtn[0]=oldTxts.cancelbtn[0],txts.savebtn[0]=oldTxts.savebtn[0],txts.closebtn[0]=oldTxts.closebtn[0],oldTxts.okPbtn&&(txts.okPbtn[0]=oldTxts.okPbtn[0]),oldTxts.cancelMbtn&&(txts.cancelMbtn[0]=oldTxts.cancelMbtn[0]),oldTxts.mngbtn&&(txts.mngbtn[0]=oldTxts.mngbtn[0]),"Save Changes"==txts.savebtn[0]&&(txts.savebtn[0]="Save Lists"),// v1.1
// 1.1 to 1.2+
oldTxts.eximbtn&&(txts.eximbtn[0]=oldTxts.eximbtn[0]),
// 1.2 to 1.3+
oldTxts.utilbtn&&(txts.utilbtn[0]=oldTxts.utilbtn[0]),oldTxts.sortbtn&&(txts.sortbtn[0]=oldTxts.sortbtn[0]),oldTxts.unwwwbtn&&(txts.unwwwbtn[0]=oldTxts.unwwwbtn[0]),oldTxts.dedupbtn&&(txts.dedupbtn[0]=oldTxts.dedupbtn[0]),
// 2.0.9+ (catch-up)
oldTxts.onetime&&(txts.onetime[0]=oldTxts.onetime[0]),oldTxts.shownotc&&(txts.shownotc[0]=oldTxts.shownotc[0]),oldTxts.hidenotc&&(txts.hidenotc[0]=oldTxts.hidenotc[0]),oldTxts.impobtn&&(txts.impobtn[0]=oldTxts.impobtn[0]),oldTxts.sharebtn&&(txts.sharebtn[0]=oldTxts.sharebtn[0])),GM_setValue("textstrings",JSON.stringify(txts)))}function ghhkillevent(e){"BUTTON"!=e.currentTarget.nodeName&&"INPUT"!=e.currentTarget.nodeName&&e.stopPropagation()}function toggleBlockHiders(str){var s=document.getElementById("ghhStyleNoBlock");if("S"!=str){if("H"==str){if(s)return;(s=document.createElement("style")).id="ghhStyleNoBlock",s.setAttribute("type","text/css"),s.appendChild(document.createTextNode(".ghhb{display:none}")),document.body.appendChild(s)}}else s&&s.remove()}function refreshListeners(e){// for AutoPager extension
var bbtns,bnotc,i,j;if(document.getElementById("navcnt")){for(bbtns=document.getElementById("navcnt").querySelectorAll(".ghhb"),i=0;i<bbtns.length;i++)bbtns[i].removeEventListener("click",showbfd,!0),bbtns[i].addEventListener("click",showbfd,!0);for(bnotc=document.getElementById("navcnt").querySelectorAll(".ghhd"),i=0;i<bnotc.length;i++)for(bnotc[i].removeEventListener("click",reshow,!0),bnotc[i].addEventListener("click",reshow,!0),bbtns=bnotc[i].querySelectorAll("button.ghhider"),j=0;j<bbtns.length;j++)"Unblock this site"==bbtns[j].getAttribute("title")&&(bbtns[j].removeEventListener("click",unblock,!0),bbtns[j].addEventListener("click",unblock,!0)),"Permanently hide this site"==bbtns[j].getAttribute("title")&&(bbtns[j].removeEventListener("click",permban,!0),bbtns[j].addEventListener("click",permban,!0)),"Re-hide this hit"==bbtns[j].getAttribute("title")&&(bbtns[j].removeEventListener("click",rehide,!0),bbtns[j].addEventListener("click",rehide,!0))}}function convertPrefs(arrPrefs,allnew){if(ghhPrefO=arrPrefs,!GM4){// Legacy only
if("true"==allnew){// 1.3.7 to 1.4.x
var tmp=GM_getValue("shownotc");tmp&&(tmp.length>0&&(ghhPrefO.shownotc[0]=tmp),GM_deleteValue("shownotc")),(tmp=GM_getValue("mngpaneopen"))&&(tmp.length>0&&(ghhPrefO.mngpaneopen[0]=tmp),GM_deleteValue("mngpaneopen")),(tmp=GM_getValue("mngbtnstyle"))&&tmp.length>0&&(tmp.indexOf("-")>-1&&(tmp="both"),// default ancient pref
ghhPrefO.mngbtnstyle[0]=tmp,GM_deleteValue("mngbtnstyle")),(tmp=GM_getValue("addtolistpos"))&&(tmp.length>0&&(ghhPrefO.addtolistpos[0]=tmp),GM_deleteValue("addtolistpos")),(tmp=GM_getValue("aggressiveblock"))&&(tmp.length>0&&(ghhPrefO.aggressiveblock[0]=tmp),GM_deleteValue("aggressiveblock")),(tmp=GM_getValue("usemutation"))&&(tmp.length>0&&(ghhPrefO.usemutation[0]=tmp),GM_deleteValue("usemutation"))}else if(ghhPrefs.indexOf("reserved1")>-1){var oldPrefs=JSON.parse(ghhPrefs);ghhPrefO.shownotc[0]=oldPrefs.shownotc[0],ghhPrefO.mngpaneopen[0]=oldPrefs.mngpaneopen[0],ghhPrefO.mngbtnstyle[0]=oldPrefs.mngbtnstyle[0],ghhPrefO.addtolistpos[0]=oldPrefs.addtolistpos[0],ghhPrefO.aggressiveblock[0]=oldPrefs.aggressiveblock[0],ghhPrefO.usemutation[0]=oldPrefs.usemutation[0],ghhPrefO.oneclick[0]=oldPrefs.oneclick[0]}GM_setValue("ghhprefs",JSON.stringify(ghhPrefO))}}function togglebbtn(e){var bbtn=e.currentTarget.querySelector('.ghhb');bbtn&&("mouseover"==e.type?bbtn.style.visibility="":bbtn.style.visibility="hidden")}function reQuery(e){var ss,rads,i;if(e?(ss="ghhbf5"==e.target.id?"+site:":"+-site:",rads=e.target.form.querySelectorAll('input[type="radio"]')):(ss="+-site:",// ALT omit
rads=document.querySelector('#ghhblockform form').querySelectorAll('input[type="radio"]')),rads.length>0){for(i=0;i<rads.length;i++)if(rads[i].checked){reQry(ss+=rads[i].nextElementSibling.textContent);break}}else console.log("LOG:reQuery fail: no rads")}function reQry(d){if(d){var qsp=window.location.href.indexOf("?");if(!(qsp<0)){var q=window.location.href.substr(qsp+1);if("+-"!=d.substr(0,2)||!(q.indexOf(d+"%20")>-1||q.indexOf(d+"&")>-1)){for(// try to block dups, may be overinclusive
var qa=q.split("&"),has_q=!1,j=qa.length-1;j>=0;j--){if("q"==qa[j].split("=")[0]){qa[j]+=d,has_q=!0;break}if(qa[j].indexOf("#q=")>-1){qa[j]+=d,has_q=!0;break}}has_q?window.location.href=window.location.href.substr(0,window.location.href.indexOf("?")+1)+qa.join("&"):console.log("LOG:Unable to add new search term to URL")}}}}function toggleciteline(posit){var ghhbd_sty=document.getElementById("bbposciteline");if("C"==posit)ghhbd_sty||((ghhbd_sty=document.createElement("style")).id="bbposciteline",ghhbd_sty.setAttribute("type","text/css"),document.body.appendChild(ghhbd_sty)),
// "inline" the action menu
ghhbd_sty.appendChild(document.createTextNode(".action-menu {vertical-align:baseline !important;} .action-menu .clickable-dropdown-arrow, .action-menu .ab_button, .action-menu > a {display:none !important;} .action-menu-panel, .action-menu-panel ul, .action-menu-panel ol, .action-menu-item {display:inline !important; visibility: visible !important; border:none !important; box-shadow:none !important; background-color:transparent !important; margin:0  !important; padding:0 !important; top:0 !important; height:auto !important; line-height:auto !important;} .action-menu-item a.fl, .action-menu-button {padding:0 0 0 6px !important; display:inline !important;}  .action-menu-panel {position:static;} .action-menu-item a.fl:hover {text-decoration:underline !important;} .action-menu + .crc {margin-right: 9px !important;} .action-menu + .crc ._Bs {margin-left: 1px !important;}")),
// restyle the block button
ghhbd_sty.appendChild(document.createTextNode(".ghhb {border:none!important; text-decoration:none!important; font-size:1em!important; color:#333!important; padding:0!important; margin-left:8px!important;} .ghhb:hover {background:transparent!important; text-decoration:underline !important;}"));else// remove citeline rules
if(ghhbd_sty)for(;ghhbd_sty.firstChild;)ghhbd_sty.removeChild(ghhbd_sty.firstChild)}function openCustomStyleBar(e){
// Create fixed div with text input and buttons: Save, Test, Close
var csb=document.getElementById("ghhcsb");csb?csb.style.display="block":((csb=document.createElement("div")).id="ghhcsb",csb.setAttribute("style","position:fixed;bottom:0;left:0;z-index:750;width:100%;background-color:#afa;"),csb.innerHTML="<form onsubmit=\"return false;\"><p style=\"margin:0.75em;\"><input id=\"ghhcsbrule\" type=\"text\" style=\"width:80%\"> <button type=\"button\" id=\"ghhcsb1\" title=\"Save and Apply\">Save</button> <button type=\"button\" id=\"ghhcsb2\" title=\"Test Current Rules\">Test</button> <button type=\"button\" id=\"ghhcsb3\" title=\"Close\">Close</button></p></form>",document.body.appendChild(csb),document.getElementById("ghhcsb1").addEventListener("click",saveCustomStyle,!0),document.getElementById("ghhcsb2").addEventListener("click",testCustomStyle,!0),document.getElementById("ghhcsb3").addEventListener("click",closeCustomStyleBar,!0)),document.getElementById("ghhcsbrule").value=custSty}async function saveCustomStyle(e){
// Update preferences and apply change to style#ghhbdcuststy
custSty=document.getElementById("ghhcsbrule").value,GM4?await GM.setValue("hiderStyles",custSty):GM_setValue("hiderStyles",custSty),injectCustom(),document.getElementById("ghhbdcuststy").innerHTML="",document.getElementById("ghhbdcuststy").appendChild(document.createTextNode(custSty))}function testCustomStyle(e){
// Add/Edit style#ghhbdcuststy
injectCustom(),document.getElementById("ghhbdcuststy").innerHTML="",document.getElementById("ghhbdcuststy").appendChild(document.createTextNode(document.getElementById("ghhcsbrule").value))}function closeCustomStyleBar(e){
// Turn off display and reapply saved style to style#ghhbdcuststy
document.getElementById("ghhcsb").style.display="none",injectCustom(),document.getElementById("ghhbdcuststy").innerHTML="",document.getElementById("ghhbdcuststy").appendChild(document.createTextNode(custSty))}function removePBs(e){document.querySelectorAll("table#GTR li[blockhidden], table#GTR div.g[blockhidden], table#GTR td:empty").length<1||(t_pb&&window.clearTimeout(t_pb),t_pb=window.setTimeout(GMRshuffle,100))}function GMRshuffle(){// GoogleMonkeyR layout only
// Delete Permaban hits
var tbl,row,cell,empties,PBs=document.querySelectorAll("table#GTR li[blockhidden], table#GTR div.g[blockhidden]");if(PBs.length>0)for(var i=PBs.length;i>0;i--)PBs[i-1].remove();
// Check entire table for empty cells and shuffle contents
for(tbl=document.getElementById("GTR"),row=0;row<tbl.rows.length;row++)if((empties=tbl.rows[row].querySelectorAll("td:empty").length)>0&&empties<tbl.rows[row].cells.length)for(cell=0;cell<tbl.rows[row].cells.length;cell++)if(0==tbl.rows[row].cells[cell].childNodes.length&&"STOP"==fillFromNext(tbl.rows[row].cells[cell]))return t_pb&&window.clearTimeout(t_pb),void(t_pb=window.setTimeout(GMRshuffle,1e3))}function fillFromNext(tgt){var src=getNextCell(tgt,!0);if(!src)return"STOP";for(;src.childNodes.length>0;)tgt.appendChild(src.childNodes[0])}function getNextCell(aCell,blnNonEmpty){for(var retcell,startcell=aCell,i=0;i<1e3;){if(startcell.nextElementSibling)// not the last cell in the row
retcell=startcell.nextElementSibling;else{if(!startcell.parentNode.nextElementSibling)return null;// end of table
// last cell in row and there's another row
retcell=startcell.parentNode.nextElementSibling.cells[0]}if(!retcell)return null;// corrupted table structure
if(!blnNonEmpty)return retcell;if(retcell.querySelector("li"))return retcell;startcell=retcell,i++}}
// "Add All" feature 2.0.9
async function addAllNow(e){for(var unb=document.querySelectorAll('[ghhresult="unset"][ghhhost]'),dom='',pdom='',domlist='',i=0;i<unb.length;i++){if((pdom=(
// Compute domain based on user preference
dom=unb[i].getAttribute('ghhhost')).substr(dom.indexOf('.')+1)).indexOf('.')>-1&&1!=patIPv4.test(dom))switch(bAggress){case'all':dom=pdom;break;case'www':'www'==dom.substr(0,3)&&(dom=pdom)}
// Add dom to doms arrray (avoiding duplicates)
!0!==doms.includes(dom)&&doms.push(dom)}
// Add new domains to the currently displayed block list
// pban
domlist='ghhts3'==document.querySelector('button.ghhCurTab').id?doms.join(':p|')+':p':doms.join(':t|')+':t','|'!=blist.substr(0,1)&&(blist='|'+blist),'end'==addAt?blist+=domlist+'|':blist='|'+domlist+blist,needupdate=!0,
// Store the list
GM4?await GM.setValue('hideyhosts',blist):GM_setValue('hideyhosts',blist),
// Apply the change to the results
hidehits(null,!0),document.getElementById('GTR')&&removePBs(),
// Update the dialog
'sort'==addAt&&sortlist(null),refreshSiteList()}